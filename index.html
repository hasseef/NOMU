<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>منصة نمو — نموذج أولي</title>
  <meta name="description" content="منصة نمو — نموذج أولي أحادي الملف يعرض الأدوار، مؤشرات الأداء، الإحالات، المحفظة، ولوحات للقطاعات." />
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="font-sans text-slate-800">
  <div id="root"></div>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script type="text/babel" data-presets="react">
    const { useState, useEffect } = React;
    const regions=["الرياض","مكة المكرمة","الشرقية","المدينة","عسير","حائل","تبوك","القصيم","نجران","جازان","الجوف","الباحة","الحدود الشمالية"];
    const roles=[{id:"guest",label:"ضيف"},{id:"family",label:"الأسرة/الأفراد"},{id:"health",label:"الصحة"},{id:"edu",label:"التعليم"},{id:"ngo",label:"الجمعيات"},{id:"csr",label:"القطاع الخاص (CSR)"},{id:"national",label:"اللجنة الوطنية"}];
    const store={get:(k,f)=>{try{return JSON.parse(localStorage.getItem(k))??f}catch{return f}},set:(k,v)=>localStorage.setItem(k,JSON.stringify(v)),del:(k)=>localStorage.removeItem(k)};
    function init(){ if(!store.get("nomu_proto_initialized",false)){ store.set("nomu_user",{role:"guest",region:"الرياض",name:""});
      store.set("nomu_kpis",{period:"آخر 30 يومًا",byRegion:{"الرياض":{coverage:82,immunization:91,readiness:76,referralsMedianHrs:18,kgEnroll:88,completeness:96}}});
      store.set("nomu_referrals",[{id:"RF-1001",child:"محمد.س",type:"صحي",status:"مفتوحة",created:"2025-09-20",region:"الرياض"}]);
      store.set("nomu_wallet",{total:35000,entries:[{id:"TRX-01",source:"شركة ألف — رعاية روضة",amount:20000,date:"2025-09-05",tag:"CSR"}]});
      store.set("nomu_settings",{brand:"نمو",primary:"#059669",logoType:"text"}); store.set("nomu_proto_initialized",true);}}
    const Logo=()=>{const s=store.get("nomu_settings",{brand:"نمو",primary:"#059669"});return(<div className="inline-flex items-center gap-2"><span className="inline-block h-7 w-7 rounded-xl" style={{background:s.primary,opacity:0.2}}></span><span className="text-xl font-bold" style={{color:s.primary}}>منصة {s.brand}</span></div>)};
    const TopBar=({onLogout})=>{const u=store.get("nomu_user",{});return(<div className="border-b"><div className="max-w-7xl mx-auto px-3 h-14 flex items-center justify-between"><a href="#/home"><Logo/></a><div className="hidden md:flex gap-2 text-sm"><a href="#/home">الرئيسية</a><a href="#/kpis">مؤشرات الأداء</a><a href="#/ref">الإحالات</a><a href="#/wallet">المحفظة</a><a href="#/sectors">القطاعات</a><a href="#/support">الدعم</a><a href="#/settings">الإعدادات</a></div><div className="flex gap-2 text-sm"><span>{u.region}</span><button onClick={onLogout} className="border rounded px-2 py-1">تبديل الدور</button></div></div></div>)};
    const Home=()=>{const u=store.get("nomu_user",{});return(<div className="max-w-7xl mx-auto px-3 py-8"><div className="border rounded-2xl p-6"><h2 className="text-xl font-bold">مرحبًا {u.name||"!"}</h2><div className="mt-4 flex gap-2 flex-wrap"><a href="#/kpis" className="border rounded px-3 py-2">مؤشرات الأداء</a><a href="#/ref" className="border rounded px-3 py-2">الإحالات</a><a href="#/wallet" className="border rounded px-3 py-2">المحفظة</a></div></div></div>)};
    const KPIs=()=>{const u=store.get("nomu_user",{});const k=store.get("nomu_kpis",{}), cur=k.byRegion[u.region]||Object.values(k.byRegion)[0];return(<div className="max-w-7xl mx-auto px-3 py-8"><h2 className="text-xl font-bold">مؤشرات الأداء — {u.region}</h2><div className="mt-4 grid sm:grid-cols-2 lg:grid-cols-3 gap-4"><div className="border rounded-2xl p-5">التغطية 0–6: <b>{cur.coverage}%</b></div><div className="border rounded-2xl p-5">التحصين: <b>{cur.immunization}%</b></div><div className="border rounded-2xl p-5">الجاهزية: <b>{cur.readiness}%</b></div></div></div>)};
    const Ref=()=>{const [list,setList]=React.useState(store.get("nomu_referrals",[]));React.useEffect(()=>store.set("nomu_referrals",list),[list]);return(<div className="max-w-7xl mx-auto px-3 py-8"><h2 className="text-xl font-bold">الإحالات</h2><div className="mt-3 overflow-x-auto border rounded-2xl"><table className="w-full text-sm"><thead><tr><th className="p-2">المعرف</th><th className="p-2">الطفل</th><th className="p-2">النوع</th><th className="p-2">الحالة</th></tr></thead><tbody>{list.map(r=><tr key={r.id} className="border-t"><td className="p-2">{r.id}</td><td className="p-2">{r.child}</td><td className="p-2">{r.type}</td><td className="p-2">{r.status}</td></tr>)}</tbody></table></div></div>)};
    const Wallet=()=>{const [w,setW]=React.useState(store.get("nomu_wallet",{total:0,entries:[]}));React.useEffect(()=>store.set("nomu_wallet",w),[w]);return(<div className="max-w-7xl mx-auto px-3 py-8"><h2 className="text-xl font-bold">المحفظة</h2><div className="mt-2 text-sm">الإجمالي: <b>{w.total.toLocaleString()} ر.س</b></div></div>)};
    const Sectors=()=>(<div className="max-w-7xl mx-auto px-3 py-8"><h2 className="text-xl font-bold">لوحات القطاعات</h2><p className="mt-2 text-sm">الصحة • التعليم • غير الربحي • القطاع الخاص • اللجنة الوطنية • الأسرة</p></div>);
    const Support=()=> (<div className="max-w-7xl mx-auto px-3 py-8"><h2 className="text-xl font-bold">الدعم</h2><ul className="mt-3 text-sm"><li>البريد: <a href="mailto:info@talbiya.sa" className="underline">info@talbiya.sa</a></li><li>واتساب: <a href="https://wa.me/966556083172" target="_blank" className="underline">+966 55 608 3172</a></li></ul></div>));
    const Settings=()=> (<div className="max-w-7xl mx-auto px-3 py-8"><h2 className="text-xl font-bold">الإعدادات</h2><button className="mt-3 border rounded px-3 py-2" onClick={()=>{['nomu_kpis','nomu_referrals','nomu_wallet','nomu_settings','nomu_user','nomu_proto_initialized'].forEach(store.del);location.reload();}}>تصفير البيانات</button></div>);
    const Login=({onLogin})=>{const [role,setRole]=useState("guest");const [region,setRegion]=useState("الرياض");const [name,setName]=useState("");return(<div className="min-h-screen grid place-items-center bg-gradient-to-tr from-nomu-50 via-white to-sky-50"><div className="w-full max-w-lg bg-white border rounded-2xl p-6"><div className="flex justify-center mb-3"><Logo/></div><h1 className="text-center font-bold text-lg">مرحبًا بك</h1><div className="grid gap-3 mt-4"><select className="border rounded px-3 py-2" value={role} onChange={e=>setRole(e.target.value)}>{roles.map(r=><option key={r.id} value={r.id}>{r.label}</option>)}</select><select className="border rounded px-3 py-2" value={region} onChange={e=>setRegion(e.target.value)}>{regions.map(r=><option key={r}>{r}</option>)}</select><input className="border rounded px-3 py-2" placeholder="الاسم (اختياري)" value={name} onChange={e=>setName(e.target.value)} /><button className="bg-nomu-600 text-white rounded px-4 py-2" onClick={()=>{store.set("nomu_user",{role,region,name});onLogin();}}>دخول</button></div></div></div>)};
    function Router(){const [h,setH]=useState(window.location.hash||"#/home");useEffect(()=>{const on=()=>setH(window.location.hash||"#/home");window.addEventListener("hashchange",on);return()=>window.removeEventListener("hashchange",on);},[]);const r=h.replace("#","");switch(r){case "/home":return <Home/>;case "/kpis":return <KPIs/>;case "/ref":return <Ref/>;case "/wallet":return <Wallet/>;case "/sectors":return <Sectors/>;case "/support":return <Support/>;case "/settings":return <Settings/>;default:return <Home/>;}};
    function App(){const [inited,setInited]=useState(false);const [logged,setLogged]=useState(!!localStorage.getItem("nomu_user"));useEffect(()=>{init();setInited(true);if(!window.location.hash)window.location.hash="/home";},[]);if(!inited)return null;if(!logged)return <Login onLogin={()=>setLogged(true)}/>;return(<div><TopBar onLogout={()=>{localStorage.removeItem("nomu_user");location.reload();}}/><Router/></div>);} ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
  </script>
</body>
</html>
