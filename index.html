<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>منصة نمو NOMU — ملف واحد كامل (Patch: شعارات يسار التوب بار)</title>
<style>
:root{
  --bg:#f7fbff; --paper:#fff; --ink:#0f172a; --sub:#475569; --muted:#f1f5f9; --border:#e2e8f0;
  --brand:#16a34a; --accent:#0ea5e9; --danger:#ef4444; --ok:#16a34a; --radius:16px; --pad:16px;
  --shadow:0 10px 30px rgba(2,12,27,.06); --font:"Tajawal","Noto Kufi Arabic",system-ui,-apple-system,"Segoe UI",Arial;
}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--ink);font:15px/1.7 var(--font)}
a{color:var(--accent);text-decoration:none}
small{color:var(--sub)}
/* Header */
header{position:sticky;top:0;z-index:50;background:#ffffffe6;backdrop-filter:blur(6px);border-bottom:1px solid var(--border)}
.topbar{max-width:1240px;margin:auto;padding:10px var(--pad);display:flex;align-items:center;gap:10px}
.brand{display:flex;align-items:center;gap:10px}
.brand .logo{width:40px;height:40px;border-radius:12px;background:conic-gradient(from 180deg,#22c55e,#86efac,#34d399,#22c55e);box-shadow:0 6px 16px rgba(16,185,129,.25)}
.left-logos{margin-inline-start:auto;display:flex;gap:8px;align-items:center}
.pill-logo{display:flex;align-items:center;gap:8px;background:var(--muted);border:1px solid var(--border);border-radius:999px;padding:6px 10px}
.pill-logo img{height:32px;display:block}
.rolebox{display:flex;gap:8px;align-items:center;background:#fff;border:1px solid var(--border);border-radius:999px;padding:6px 10px}
.bell{position:relative;cursor:pointer;border:1px solid var(--border);background:#fff;border-radius:12px;padding:8px}
.badge{position:absolute;top:-6px;left:-6px;background:var(--danger);color:#fff;border-radius:999px;font-size:11px;line-height:1;padding:3px 6px}
.npanel{position:absolute;top:54px;inset-inline-end:0;background:#fff;border:1px solid var(--border);border-radius:14px;box-shadow:var(--shadow);width:380px;max-height:60vh;overflow:auto;display:none}
.nitem{padding:10px;border-bottom:1px dashed var(--border)} .nitem:last-child{border-bottom:none}
/* Layout */
.main{max-width:1240px;margin:20px auto;display:grid;grid-template-columns:280px 1fr;gap:20px;padding:0 var(--pad)}
nav .side{position:sticky;top:72px;background:var(--paper);border:1px solid var(--border);border-radius:var(--radius);padding:10px;box-shadow:var(--shadow)}
.group h4{margin:10px 8px;color:var(--sub);font-size:13px}
.link{display:flex;gap:10px;padding:10px;border-radius:12px;color:var(--ink);border:1px solid transparent}
.link:hover{background:var(--muted);border-color:var(--border)}
.link.active{background:linear-gradient(180deg,#ecfdf5,#e7f9f0);border-color:#befae0}
.content{display:grid;gap:20px}
/* Cards & UI */
.card{background:var(--paper);border:1px solid var(--border);border-radius:var(--radius);padding:var(--pad);box-shadow:var(--shadow)}
.toolbar{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
.row{display:flex;gap:12px;flex-wrap:wrap}
.col{flex:1 1 280px}
.tag{display:inline-flex;align-items:center;gap:6px;border:1px solid var(--border);background:#f0fdf4;color:#14532d;padding:6px 10px;border-radius:999px;font-size:12px}
.btn{background:var(--brand);color:#052e1d;border:none;padding:9px 12px;border-radius:12px;font-weight:800;cursor:pointer;box-shadow:0 6px 18px rgba(34,197,94,.25)}
.ghost{background:transparent;border:1px solid var(--border);color:var(--ink)}
.input{width:100%;padding:10px 12px;border:1px solid var(--border);border-radius:12px;background:#fff}
.select{padding:10px;border:1px solid var(--border);border-radius:12px;background:#fff}
.switch{appearance:none;width:40px;height:22px;border-radius:999px;background:#e5e7eb;position:relative;cursor:pointer;vertical-align:middle}
.switch:checked{background:#10b981}
.switch:before{content:"";position:absolute;top:3px;right:3px;width:16px;height:16px;border-radius:50%;background:#fff;transition:.2s}
.switch:checked:before{transform:translateX(-18px)}
.table{width:100%;border-collapse:separate;border-spacing:0 8px}
.table th{font-size:12px;color:#475569;text-align:start;padding:8px}
.table td{background:#fff;border:1px solid var(--border);border-left:none;border-right:none;padding:10px}
.tr{background:#fff;border:1px solid var(--border);border-radius:12px}
.kpi-pill{display:flex;justify-content:space-between;background:#f8fafc;border:1px solid var(--border);border-radius:12px;padding:10px 12px;font-size:13px}
footer{max-width:1240px;margin:22px auto 36px;color:#64748b;text-align:center;padding:0 var(--pad)}
@media (max-width:980px){ .main{grid-template-columns:1fr} }
</style>
</head>

<body>
<header>
  <div class="topbar">
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <div>
        <b>NOMU — منصة نمو</b>
        <div style="font-size:12px;color:#0f766e">منصة وطنية للطفولة المبكرة</div>
      </div>
    </div>

    <!-- الجهة اليسرى: إضافة الشعارين فقط (Patch) + بقية العناصر كما هي -->
    <div class="left-logos">
      <!-- ▼▼ الإضافة الجديدة: شعاري رؤية 2030 وتلبية ▼▼ -->
      <span class="pill-logo" title="Vision 2030">
        <img src="Vision 2030.png" alt="شعار رؤية 2030">
      </span>
      <span class="pill-logo" title="مبادرة تلبية">
        <img src="talbiya.png" alt="شعار مبادرة تلبية">
      </span>
      <!-- ▲▲ نهاية الإضافة ▲▲ -->

      <!-- إبقاء بقية العناصر كما هي دون تغيير -->
      <div class="rolebox">
        <span>الدور:</span>
        <select id="currentRole" class="select">
          <option>clinic.staff</option>
          <option>health.practitioner</option>
          <option>education.specialist</option>
          <option>neighborhood.coordinator</option>
          <option>nonprofit.worker</option>
          <option>admin.national</option>
          <option>family.guardian</option>
        </select>
      </div>
      <div style="position:relative">
        <button id="bell" class="bell">🔔<span id="bellBadge" class="badge" style="display:none">0</span></button>
        <div id="npanel" class="npanel"></div>
      </div>
    </div>
  </div>
</header>

<main class="main">
  <nav>
    <div class="side">
      <div class="group">
        <h4>عام</h4>
        <a class="link" data-route="#/overview">نظرة عامة</a>
        <a class="link" data-route="#/kpi">مؤشرات الأداء KPIs</a>
        <a class="link" data-route="#/reports">التقارير</a>
      </div>
      <div class="group">
        <h4>الحسابات التشغيلية</h4>
        <a class="link" data-route="#/acc/health">وزارة الصحة</a>
        <a class="link" data-route="#/acc/clinic">المراكز الصحية</a>
        <a class="link" data-route="#/acc/education">وزارة التعليم</a>
        <a class="link" data-route="#/acc/neighborhood">مراكز الأحياء</a>
      </div>
      <div class="group">
        <h4>حوكمة</h4>
        <a class="link" data-route="#/policies">السياسات والخصوصية</a>
        <a class="link" data-route="#/help">مركز المساعدة</a>
      </div>
    </div>
  </nav>

  <section class="content" id="view"></section>
</main>

<footer>نمو NOMU — ملف واحد كامل. © جميع الحقوق محفوظة.</footer>

<script>
/* ————— بيانات وتجهيزات عامة ————— */
const $ = (sel,ctx=document)=>ctx.querySelector(sel);
const $$ = (sel,ctx=document)=>[...ctx.querySelectorAll(sel)];

// إشعارات تجريبية
const notifications = [
  {t:"تحديث مؤشر: سرعة الاستجابة ارتفع 4%", time:"اليوم 09:15"},
  {t:"طلب اعتماد ورشة تدريب في مركز حي المروج", time:"أمس 18:22"},
  {t:"إنشاء مركز صحي جديد — حجز المواعيد مفعّل", time:"أمس 10:04"},
];
function setupBell() {
  const bell = $("#bell");
  const badge = $("#bellBadge");
  const panel = $("#npanel");
  badge.textContent = notifications.length;
  badge.style.display = notifications.length ? "inline-block":"none";
  panel.innerHTML = notifications.map(n => `<div class="nitem"><b>${n.t}</b><br><small>${n.time}</small></div>`).join("");
  bell.onclick = ()=> panel.style.display = panel.style.display==="block" ? "none" : "block";
  document.addEventListener("click",(e)=>{ if(!panel.contains(e.target) && e.target!==bell){ panel.style.display="none"; }});
}

// عناصر وهمية للجداول
const MOCK_ITEMS = Array.from({ length: 28 }).map((_, i) => ({
  id: i + 1,
  title: `عنصر ${i + 1}`,
  owner: ["وزارة الصحة","مركز صحي","وزارة التعليم","مركز حي","فريق تشغيلي"][i % 5],
  status: ["مسودة","قيد المراجعة","نشط","مكتمل"][i % 4],
  tag: ["تشغيل","تقني","تنموي","تقارير"][i % 4],
  score: Math.round(60 + Math.random()*40),
}));

// تعريفات KPI
let KPIS = [
  { key: "delivery_speed", name: "سرعة التسليم", owner: "فريق التشغيل", definition: "متوسط زمن إنجاز المخرجات." },
  { key: "partner_satisfaction", name: "رضا الشركاء", owner: "الشراكات", definition: "مؤشر رضا الشركاء بالمشاريع المشتركة." },
  { key: "quality_index", name: "مؤشر الجودة", owner: "ضمان الجودة", definition: "نسبة الالتزام بالمعايير في المشاريع." },
  { key: "impact_score", name: "درجة الأثر", owner: "قياس الأثر", definition: "مؤشر مركّب لقياس أثر مبادرات نمو." },
];

/* ————— مكوّنات عرض ————— */
function card(title, body, right=null) {
  return `
  <div class="card">
    <div class="toolbar">
      <h2>${title}</h2>
      <div class="row">
        ${right? right: "" }
      </div>
    </div>
    ${body}
  </div>`;
}

function renderOverview(){
  const stats = `
    <div class="row">
      <div class="col">
        <div class="kpi-pill"><span>مشاريع نشطة</span><b>${MOCK_ITEMS.filter(x=>x.status==="نشط").length}</b></div>
      </div>
      <div class="col">
        <div class="kpi-pill"><span>طلبات قيد المراجعة</span><b>${MOCK_ITEMS.filter(x=>x.status==="قيد المراجعة").length}</b></div>
      </div>
      <div class="col">
        <div class="kpi-pill"><span>متوسط درجة الجودة</span><b>${
          Math.round(MOCK_ITEMS.reduce((a,b)=>a+b.score,0)/MOCK_ITEMS.length)
        }%</b></div>
      </div>
    </div>
  `;
  const tbl = renderTable(MOCK_ITEMS, {search:true, filter:true});
  $("#view").innerHTML =
    card("نظرة عامة", `<p>لوحة عامة لعناصر الأعمال عبر جميع الحسابات.</p>${stats}${tbl}`, `<span class="tag">نسخة تجريبية</span>`);
}

function renderKPIs(){
  const list = KPIS.map(k=>`
    <div class="kpi-pill">
      <div><b>${k.name}</b><br><small>${k.definition}</small></div>
      <span class="tag">${k.owner}</span>
    </div>`).join("");
  const editor = `
    <div class="row">
      <div class="col">
        <label>محرر JSON</label>
        <textarea id="kpiJson" class="input" style="height:260px;font-family:ui-monospace,monospace;">${JSON.stringify(KPIS,null,2)}</textarea>
        <div class="row" style="margin-top:8px">
          <button class="btn" id="applyKpi">تطبيق</button>
          <button class="btn ghost" id="resetKpi">إرجاع الافتراضي</button>
        </div>
        <small id="kpiMsg"></small>
      </div>
      <div class="col">
        <label>المعايير الحالية</label>
        <div id="kpiList" class="row" style="gap:10px;flex-direction:column">${list}</div>
      </div>
    </div>
  `;
  $("#view").innerHTML = card("مؤشرات الأداء (KPIs)", editor);
  $("#applyKpi").onclick = ()=>{
    const msg = $("#kpiMsg");
    try{
      const parsed = JSON.parse($("#kpiJson").value);
      if(!Array.isArray(parsed)) throw Error("صيغة غير صحيحة: يجب أن تكون مصفوفة");
      KPIS = parsed;
      msg.style.color = "var(--ok)"; msg.textContent = "تم التطبيق.";
      renderKPIs();
    }catch(e){ msg.style.color = "var(--danger)"; msg.textContent = "خطأ في JSON: "+e.message; }
  };
  $("#resetKpi").onclick = ()=>{ renderKPIs(); };
}

function renderReports(){
  const body = `
    <div class="row">
      <input class="input col" type="date" id="fromDate"/>
      <input class="input col" type="date" id="toDate"/>
      <select class="select col" id="repType">
        <option value="summary">ملخص تنفيذي</option>
        <option value="kpi">مؤشرات الأداء</option>
        <option value="ops">تشغيل الحسابات</option>
      </select>
    </div>
    <div class="row" style="margin-top:10px">
      <button class="btn" id="exportCsv">تصدير CSV</button>
      <small>سيُنشأ ملف CSV بالبيانات المُفلترة.</small>
    </div>
    <div id="repMsg" style="margin-top:8px"></div>
  `;
  $("#view").innerHTML = card("التقارير", body);
  $("#exportCsv").onclick = ()=>{
    const type = $("#repType").value;
    // تصدير بسيط
    const rows = [["#","العنوان","الجهة","الحالة","وسم","النتيجة"]];
    MOCK_ITEMS.forEach(r=>rows.push([r.id,r.title,r.owner,r.status,r.tag,r.score]));
    const csv = rows.map(r=>r.map(x=>`"${String(x).replace(/"/g,'""')}"`).join(",")).join("\n");
    const blob = new Blob([csv],{type:"text/csv;charset=utf-8"});
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob); a.download = `nomu_${type}.csv`; a.click();
    $("#repMsg").innerHTML = `<span class="tag">تم إنشاء التقرير</span>`;
  };
}

function renderPolicies(){
  const body = `
    <div class="row">
      <div class="col card" style="padding:12px">
        <h3>حماية الطفل</h3>
        <label style="display:flex;align-items:center;gap:8px;margin-top:6px">
          <input id="childSafe" type="checkbox" class="switch" checked />
          <span>تفعيل أدوات الحماية</span>
        </label>
        <small>إخفاء البيانات الحساسة، موافقة ولي الأمر، آليات الإبلاغ.</small>
      </div>
      <div class="col card" style="padding:12px">
        <h3>الاحتفاظ بالبيانات</h3>
        <div class="row" style="margin-top:6px">
          <input id="retention" class="input" style="max-width:120px" type="number" value="12"/>
          <span>شهرًا</span>
        </div>
        <small>يُحذف تلقائيًا ما لم تتطلب الأنظمة الاحتفاظ لفترة أطول.</small>
      </div>
      <div class="col card" style="padding:12px">
        <h3>الاستخدام العادل</h3>
        <p>تُستخدم البيانات لأغراض تشغيل "نمو" فقط مع تفعيل إخفاء الهوية للتحليلات.</p>
      </div>
    </div>
  `;
  $("#view").innerHTML = card("السياسات والخصوصية", body);
}

function renderHelp(){
  const body = `
    <div class="row">
      <div class="col card" style="padding:12px">
        <h3>كيف أضيف نشاطًا؟</h3>
        <p>من الحساب المناسب، اضغط <b>عنصر جديد</b> وأكمل الحقول ثم احفظ.</p>
      </div>
      <div class="col card" style="padding:12px">
        <h3>تحديث مؤشرات الأداء</h3>
        <p>انتقل إلى تبويب <b>KPIs</b> وعدّل JSON ثم اضغط <b>تطبيق</b>.</p>
      </div>
      <div class="col card" style="padding:12px">
        <h3>تصدير تقرير</h3>
        <p>من تبويب <b>التقارير</b> اختر النطاق والنوع ثم <b>تصدير CSV</b>.</p>
      </div>
    </div>
  `;
  $("#view").innerHTML = card("مركز المساعدة", body);
}

function renderAccount(title, sections){
  const sectionTree = sections.map(s=>`<li>• ${s}</li>`).join("");
  const filters = `
    <div class="row">
      <input id="q" class="input" placeholder="بحث…"/>
      <select id="status" class="select">
        <option value="">كل الحالات</option>
        <option>مسودة</option><option>قيد المراجعة</option><option>نشط</option><option>مكتمل</option>
      </select>
      <button class="btn" id="newItem">عنصر جديد</button>
    </div>
  `;
  const tbl = renderTable(MOCK_ITEMS, {searchEl:"#q", filterEl:"#status"});
  const body = `
    <div class="row">
      <div class="col card" style="padding:12px">
        <h3>التفريعات (حتى 4 مستويات)</h3>
        <ul>${sectionTree}</ul>
      </div>
      <div class="col" style="min-width:360px">
        ${filters}
        ${tbl}
      </div>
    </div>
  `;
  $("#view").innerHTML = card(title, body, `<span class="tag">تشغيلي</span>`);
  $("#newItem").onclick = ()=>alert("نموذج إضافة — حفظ محلي للتجربة");
}

function renderTable(source, opts={}){
  let data = [...source];
  const html = `
    <div class="card" style="padding:0">
      <table class="table">
        <thead>
          <tr>
            <th>#</th><th>العنوان</th><th>المالك/الجهة</th><th>الحالة</th><th>وسم</th><th>النتيجة</th>
          </tr>
        </thead>
        <tbody id="rows">
          ${data.map(r=>`
            <tr class="tr">
              <td style="padding-inline:12px">${r.id}</td>
              <td>${r.title}</td>
              <td>${r.owner}</td>
              <td>${r.status}</td>
              <td>${r.tag}</td>
              <td>${r.score}</td>
            </tr>
          `).join("")}
        </tbody>
      </table>
    </div>
  `;
  // تفعيل البحث/التصفية لاحقًا حسب العناصر إن وُجدت
  queueMicrotask(()=>{
    const qEl = typeof opts.searchEl==="string" ? $(opts.searchEl) : null;
    const sEl = typeof opts.filterEl==="string" ? $(opts.filterEl) : null;
    const rows = $("#rows");
    function apply(){
      const q = (qEl && qEl.value)||"";
      const st = (sEl && sEl.value)||"";
      const filtered = source.filter(r =>
        (!q || r.title.includes(q) || r.owner.includes(q) || r.tag.includes(q)) &&
        (!st || r.status===st)
      );
      rows.innerHTML = filtered.map(r=>`
        <tr class="tr">
          <td style="padding-inline:12px">${r.id}</td>
          <td>${r.title}</td>
          <td>${r.owner}</td>
          <td>${r.status}</td>
          <td>${r.tag}</td>
          <td>${r.score}</td>
        </tr>
      `).join("");
    }
    if(qEl) qEl.addEventListener("input", apply);
    if(sEl) sEl.addEventListener("change", apply);
  });
  return html;
}

/* ————— الراوتر ————— */
const routes = {
  "#/overview": renderOverview,
  "#/kpi": renderKPIs,
  "#/reports": renderReports,
  "#/policies": renderPolicies,
  "#/help": renderHelp,
  "#/acc/health": ()=>renderAccount("وزارة الصحة", [
    "إدارة البرامج الوطنية","تخصيص الموارد","لوحة مؤشرات صحية","سجل الموافقات"
  ]),
  "#/acc/clinic": ()=>renderAccount("المراكز الصحية", [
    "إدارة المواعيد","خدمات المجتمع","التقارير اليومية","التكامل مع الأحياء"
  ]),
  "#/acc/education": ()=>renderAccount("وزارة التعليم", [
    "برامج الطفولة المبكرة","المدربون والورش","التقييم والمتابعة","التعاون مع الصحة"
  ]),
  "#/acc/neighborhood": ()=>renderAccount("مراكز الأحياء", [
    "الحملات التوعوية","المرافق والفعالية","المتطوعون","التقارير"
  ]),
};

function navTo(hash){
  const fn = routes[hash] || routes["#/overview"];
  // تمييز الرابط النشط
  $$(".link").forEach(a=>{
    if(a.getAttribute("data-route")===hash) a.classList.add("active"); else a.classList.remove("active");
  });
  fn();
  window.scrollTo({top:0,behavior:"smooth"});
}

/* ————— تشغيل ————— */
setupBell();
$$(".link").forEach(a=>a.onclick = (e)=>{ e.preventDefault(); location.hash = a.getAttribute("data-route"); });
window.addEventListener("hashchange", ()=>navTo(location.hash));
if(!location.hash) location.hash = "#/overview";
navTo(location.hash);
</script>
</body>
</html>
