<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Ù…Ù†ØµØ© Ù†Ù…Ùˆ NOMU â€” Ù…Ù„Ù ÙˆØ§Ø­Ø¯ ÙƒØ§Ù…Ù„ (Patch: Ø´Ø¹Ø§Ø±Ø§Øª ÙŠØ³Ø§Ø± Ø§Ù„ØªÙˆØ¨ Ø¨Ø§Ø±)</title>
<style>
:root{
  --bg:#f7fbff; --paper:#fff; --ink:#0f172a; --sub:#475569; --muted:#f1f5f9; --border:#e2e8f0;
  --brand:#16a34a; --accent:#0ea5e9; --danger:#ef4444; --ok:#16a34a; --radius:16px; --pad:16px;
  --shadow:0 10px 30px rgba(2,12,27,.06); --font:"Tajawal","Noto Kufi Arabic",system-ui,-apple-system,"Segoe UI",Arial;
}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--ink);font:15px/1.7 var(--font)}
a{color:var(--accent);text-decoration:none}
small{color:var(--sub)}
/* Header */
header{position:sticky;top:0;z-index:50;background:#ffffffe6;backdrop-filter:blur(6px);border-bottom:1px solid var(--border)}
.topbar{max-width:1240px;margin:auto;padding:10px var(--pad);display:flex;align-items:center;gap:10px}
.brand{display:flex;align-items:center;gap:10px}
.brand .logo{width:40px;height:40px;border-radius:12px;background:conic-gradient(from 180deg,#22c55e,#86efac,#34d399,#22c55e);box-shadow:0 6px 16px rgba(16,185,129,.25)}
.left-logos{margin-inline-start:auto;display:flex;gap:8px;align-items:center}
.pill-logo{display:flex;align-items:center;gap:8px;background:var(--muted);border:1px solid var(--border);border-radius:999px;padding:6px 10px}
.pill-logo img{height:32px;display:block}
.rolebox{display:flex;gap:8px;align-items:center;background:#fff;border:1px solid var(--border);border-radius:999px;padding:6px 10px}
.bell{position:relative;cursor:pointer;border:1px solid var(--border);background:#fff;border-radius:12px;padding:8px}
.badge{position:absolute;top:-6px;left:-6px;background:var(--danger);color:#fff;border-radius:999px;font-size:11px;line-height:1;padding:3px 6px}
.npanel{position:absolute;top:54px;inset-inline-end:0;background:#fff;border:1px solid var(--border);border-radius:14px;box-shadow:var(--shadow);width:380px;max-height:60vh;overflow:auto;display:none}
.nitem{padding:10px;border-bottom:1px dashed var(--border)} .nitem:last-child{border-bottom:none}
/* Layout */
.main{max-width:1240px;margin:20px auto;display:grid;grid-template-columns:280px 1fr;gap:20px;padding:0 var(--pad)}
nav .side{position:sticky;top:72px;background:var(--paper);border:1px solid var(--border);border-radius:var(--radius);padding:10px;box-shadow:var(--shadow)}
.group h4{margin:10px 8px;color:var(--sub);font-size:13px}
.link{display:flex;gap:10px;padding:10px;border-radius:12px;color:var(--ink);border:1px solid transparent}
.link:hover{background:var(--muted);border-color:var(--border)}
.link.active{background:linear-gradient(180deg,#ecfdf5,#e7f9f0);border-color:#befae0}
.content{display:grid;gap:20px}
/* Cards & UI */
.card{background:var(--paper);border:1px solid var(--border);border-radius:var(--radius);padding:var(--pad);box-shadow:var(--shadow)}
.toolbar{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
.row{display:flex;gap:12px;flex-wrap:wrap}
.col{flex:1 1 280px}
.tag{display:inline-flex;align-items:center;gap:6px;border:1px solid var(--border);background:#f0fdf4;color:#14532d;padding:6px 10px;border-radius:999px;font-size:12px}
.btn{background:var(--brand);color:#052e1d;border:none;padding:9px 12px;border-radius:12px;font-weight:800;cursor:pointer;box-shadow:0 6px 18px rgba(34,197,94,.25)}
.ghost{background:transparent;border:1px solid var(--border);color:var(--ink)}
.input{width:100%;padding:10px 12px;border:1px solid var(--border);border-radius:12px;background:#fff}
.select{padding:10px;border:1px solid var(--border);border-radius:12px;background:#fff}
.switch{appearance:none;width:40px;height:22px;border-radius:999px;background:#e5e7eb;position:relative;cursor:pointer;vertical-align:middle}
.switch:checked{background:#10b981}
.switch:before{content:"";position:absolute;top:3px;right:3px;width:16px;height:16px;border-radius:50%;background:#fff;transition:.2s}
.switch:checked:before{transform:translateX(-18px)}
.table{width:100%;border-collapse:separate;border-spacing:0 8px}
.table th{font-size:12px;color:#475569;text-align:start;padding:8px}
.table td{background:#fff;border:1px solid var(--border);border-left:none;border-right:none;padding:10px}
.tr{background:#fff;border:1px solid var(--border);border-radius:12px}
.kpi-pill{display:flex;justify-content:space-between;background:#f8fafc;border:1px solid var(--border);border-radius:12px;padding:10px 12px;font-size:13px}
footer{max-width:1240px;margin:22px auto 36px;color:#64748b;text-align:center;padding:0 var(--pad)}
@media (max-width:980px){ .main{grid-template-columns:1fr} }
</style>
</head>

<body>
<header>
  <div class="topbar">
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <div>
        <b>NOMU â€” Ù…Ù†ØµØ© Ù†Ù…Ùˆ</b>
        <div style="font-size:12px;color:#0f766e">Ù…Ù†ØµØ© ÙˆØ·Ù†ÙŠØ© Ù„Ù„Ø·ÙÙˆÙ„Ø© Ø§Ù„Ù…Ø¨ÙƒØ±Ø©</div>
      </div>
    </div>

    <!-- Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„ÙŠØ³Ø±Ù‰: Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø´Ø¹Ø§Ø±ÙŠÙ† ÙÙ‚Ø· (Patch) + Ø¨Ù‚ÙŠØ© Ø§Ù„Ø¹Ù†Ø§ØµØ± ÙƒÙ…Ø§ Ù‡ÙŠ -->
    <div class="left-logos">
      <!-- â–¼â–¼ Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©: Ø´Ø¹Ø§Ø±ÙŠ Ø±Ø¤ÙŠØ© 2030 ÙˆØªÙ„Ø¨ÙŠØ© â–¼â–¼ -->
      <span class="pill-logo" title="Vision 2030">
        <img src="Vision 2030.png" alt="Ø´Ø¹Ø§Ø± Ø±Ø¤ÙŠØ© 2030">
      </span>
      <span class="pill-logo" title="Ù…Ø¨Ø§Ø¯Ø±Ø© ØªÙ„Ø¨ÙŠØ©">
        <img src="talbiya.png" alt="Ø´Ø¹Ø§Ø± Ù…Ø¨Ø§Ø¯Ø±Ø© ØªÙ„Ø¨ÙŠØ©">
      </span>
      <!-- â–²â–² Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¥Ø¶Ø§ÙØ© â–²â–² -->

      <!-- Ø¥Ø¨Ù‚Ø§Ø¡ Ø¨Ù‚ÙŠØ© Ø§Ù„Ø¹Ù†Ø§ØµØ± ÙƒÙ…Ø§ Ù‡ÙŠ Ø¯ÙˆÙ† ØªØºÙŠÙŠØ± -->
      <div class="rolebox">
        <span>Ø§Ù„Ø¯ÙˆØ±:</span>
        <select id="currentRole" class="select">
          <option>clinic.staff</option>
          <option>health.practitioner</option>
          <option>education.specialist</option>
          <option>neighborhood.coordinator</option>
          <option>nonprofit.worker</option>
          <option>admin.national</option>
          <option>family.guardian</option>
        </select>
      </div>
      <div style="position:relative">
        <button id="bell" class="bell">ğŸ””<span id="bellBadge" class="badge" style="display:none">0</span></button>
        <div id="npanel" class="npanel"></div>
      </div>
    </div>
  </div>
</header>

<main class="main">
  <nav>
    <div class="side">
      <div class="group">
        <h4>Ø¹Ø§Ù…</h4>
        <a class="link" data-route="#/overview">Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©</a>
        <a class="link" data-route="#/kpi">Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡ KPIs</a>
        <a class="link" data-route="#/reports">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</a>
      </div>
      <div class="group">
        <h4>Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠØ©</h4>
        <a class="link" data-route="#/acc/health">ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØµØ­Ø©</a>
        <a class="link" data-route="#/acc/clinic">Ø§Ù„Ù…Ø±Ø§ÙƒØ² Ø§Ù„ØµØ­ÙŠØ©</a>
        <a class="link" data-route="#/acc/education">ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…</a>
        <a class="link" data-route="#/acc/neighborhood">Ù…Ø±Ø§ÙƒØ² Ø§Ù„Ø£Ø­ÙŠØ§Ø¡</a>
      </div>
      <div class="group">
        <h4>Ø­ÙˆÙƒÙ…Ø©</h4>
        <a class="link" data-route="#/policies">Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª ÙˆØ§Ù„Ø®ØµÙˆØµÙŠØ©</a>
        <a class="link" data-route="#/help">Ù…Ø±ÙƒØ² Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©</a>
      </div>
    </div>
  </nav>

  <section class="content" id="view"></section>
</main>

<footer>Ù†Ù…Ùˆ NOMU â€” Ù…Ù„Ù ÙˆØ§Ø­Ø¯ ÙƒØ§Ù…Ù„. Â© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.</footer>

<script>
/* â€”â€”â€”â€”â€” Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØªØ¬Ù‡ÙŠØ²Ø§Øª Ø¹Ø§Ù…Ø© â€”â€”â€”â€”â€” */
const $ = (sel,ctx=document)=>ctx.querySelector(sel);
const $$ = (sel,ctx=document)=>[...ctx.querySelectorAll(sel)];

// Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©
const notifications = [
  {t:"ØªØ­Ø¯ÙŠØ« Ù…Ø¤Ø´Ø±: Ø³Ø±Ø¹Ø© Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ø±ØªÙØ¹ 4%", time:"Ø§Ù„ÙŠÙˆÙ… 09:15"},
  {t:"Ø·Ù„Ø¨ Ø§Ø¹ØªÙ…Ø§Ø¯ ÙˆØ±Ø´Ø© ØªØ¯Ø±ÙŠØ¨ ÙÙŠ Ù…Ø±ÙƒØ² Ø­ÙŠ Ø§Ù„Ù…Ø±ÙˆØ¬", time:"Ø£Ù…Ø³ 18:22"},
  {t:"Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø±ÙƒØ² ØµØ­ÙŠ Ø¬Ø¯ÙŠØ¯ â€” Ø­Ø¬Ø² Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ù…ÙØ¹Ù‘Ù„", time:"Ø£Ù…Ø³ 10:04"},
];
function setupBell() {
  const bell = $("#bell");
  const badge = $("#bellBadge");
  const panel = $("#npanel");
  badge.textContent = notifications.length;
  badge.style.display = notifications.length ? "inline-block":"none";
  panel.innerHTML = notifications.map(n => `<div class="nitem"><b>${n.t}</b><br><small>${n.time}</small></div>`).join("");
  bell.onclick = ()=> panel.style.display = panel.style.display==="block" ? "none" : "block";
  document.addEventListener("click",(e)=>{ if(!panel.contains(e.target) && e.target!==bell){ panel.style.display="none"; }});
}

// Ø¹Ù†Ø§ØµØ± ÙˆÙ‡Ù…ÙŠØ© Ù„Ù„Ø¬Ø¯Ø§ÙˆÙ„
const MOCK_ITEMS = Array.from({ length: 28 }).map((_, i) => ({
  id: i + 1,
  title: `Ø¹Ù†ØµØ± ${i + 1}`,
  owner: ["ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØµØ­Ø©","Ù…Ø±ÙƒØ² ØµØ­ÙŠ","ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…","Ù…Ø±ÙƒØ² Ø­ÙŠ","ÙØ±ÙŠÙ‚ ØªØ´ØºÙŠÙ„ÙŠ"][i % 5],
  status: ["Ù…Ø³ÙˆØ¯Ø©","Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©","Ù†Ø´Ø·","Ù…ÙƒØªÙ…Ù„"][i % 4],
  tag: ["ØªØ´ØºÙŠÙ„","ØªÙ‚Ù†ÙŠ","ØªÙ†Ù…ÙˆÙŠ","ØªÙ‚Ø§Ø±ÙŠØ±"][i % 4],
  score: Math.round(60 + Math.random()*40),
}));

// ØªØ¹Ø±ÙŠÙØ§Øª KPI
let KPIS = [
  { key: "delivery_speed", name: "Ø³Ø±Ø¹Ø© Ø§Ù„ØªØ³Ù„ÙŠÙ…", owner: "ÙØ±ÙŠÙ‚ Ø§Ù„ØªØ´ØºÙŠÙ„", definition: "Ù…ØªÙˆØ³Ø· Ø²Ù…Ù† Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„Ù…Ø®Ø±Ø¬Ø§Øª." },
  { key: "partner_satisfaction", name: "Ø±Ø¶Ø§ Ø§Ù„Ø´Ø±ÙƒØ§Ø¡", owner: "Ø§Ù„Ø´Ø±Ø§ÙƒØ§Øª", definition: "Ù…Ø¤Ø´Ø± Ø±Ø¶Ø§ Ø§Ù„Ø´Ø±ÙƒØ§Ø¡ Ø¨Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ù…Ø´ØªØ±ÙƒØ©." },
  { key: "quality_index", name: "Ù…Ø¤Ø´Ø± Ø§Ù„Ø¬ÙˆØ¯Ø©", owner: "Ø¶Ù…Ø§Ù† Ø§Ù„Ø¬ÙˆØ¯Ø©", definition: "Ù†Ø³Ø¨Ø© Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ø§Ù„Ù…Ø¹Ø§ÙŠÙŠØ± ÙÙŠ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹." },
  { key: "impact_score", name: "Ø¯Ø±Ø¬Ø© Ø§Ù„Ø£Ø«Ø±", owner: "Ù‚ÙŠØ§Ø³ Ø§Ù„Ø£Ø«Ø±", definition: "Ù…Ø¤Ø´Ø± Ù…Ø±ÙƒÙ‘Ø¨ Ù„Ù‚ÙŠØ§Ø³ Ø£Ø«Ø± Ù…Ø¨Ø§Ø¯Ø±Ø§Øª Ù†Ù…Ùˆ." },
];

/* â€”â€”â€”â€”â€” Ù…ÙƒÙˆÙ‘Ù†Ø§Øª Ø¹Ø±Ø¶ â€”â€”â€”â€”â€” */
function card(title, body, right=null) {
  return `
  <div class="card">
    <div class="toolbar">
      <h2>${title}</h2>
      <div class="row">
        ${right? right: "" }
      </div>
    </div>
    ${body}
  </div>`;
}

function renderOverview(){
  const stats = `
    <div class="row">
      <div class="col">
        <div class="kpi-pill"><span>Ù…Ø´Ø§Ø±ÙŠØ¹ Ù†Ø´Ø·Ø©</span><b>${MOCK_ITEMS.filter(x=>x.status==="Ù†Ø´Ø·").length}</b></div>
      </div>
      <div class="col">
        <div class="kpi-pill"><span>Ø·Ù„Ø¨Ø§Øª Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</span><b>${MOCK_ITEMS.filter(x=>x.status==="Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©").length}</b></div>
      </div>
      <div class="col">
        <div class="kpi-pill"><span>Ù…ØªÙˆØ³Ø· Ø¯Ø±Ø¬Ø© Ø§Ù„Ø¬ÙˆØ¯Ø©</span><b>${
          Math.round(MOCK_ITEMS.reduce((a,b)=>a+b.score,0)/MOCK_ITEMS.length)
        }%</b></div>
      </div>
    </div>
  `;
  const tbl = renderTable(MOCK_ITEMS, {search:true, filter:true});
  $("#view").innerHTML =
    card("Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©", `<p>Ù„ÙˆØ­Ø© Ø¹Ø§Ù…Ø© Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ø¹Ø¨Ø± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª.</p>${stats}${tbl}`, `<span class="tag">Ù†Ø³Ø®Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ©</span>`);
}

function renderKPIs(){
  const list = KPIS.map(k=>`
    <div class="kpi-pill">
      <div><b>${k.name}</b><br><small>${k.definition}</small></div>
      <span class="tag">${k.owner}</span>
    </div>`).join("");
  const editor = `
    <div class="row">
      <div class="col">
        <label>Ù…Ø­Ø±Ø± JSON</label>
        <textarea id="kpiJson" class="input" style="height:260px;font-family:ui-monospace,monospace;">${JSON.stringify(KPIS,null,2)}</textarea>
        <div class="row" style="margin-top:8px">
          <button class="btn" id="applyKpi">ØªØ·Ø¨ÙŠÙ‚</button>
          <button class="btn ghost" id="resetKpi">Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ</button>
        </div>
        <small id="kpiMsg"></small>
      </div>
      <div class="col">
        <label>Ø§Ù„Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ©</label>
        <div id="kpiList" class="row" style="gap:10px;flex-direction:column">${list}</div>
      </div>
    </div>
  `;
  $("#view").innerHTML = card("Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡ (KPIs)", editor);
  $("#applyKpi").onclick = ()=>{
    const msg = $("#kpiMsg");
    try{
      const parsed = JSON.parse($("#kpiJson").value);
      if(!Array.isArray(parsed)) throw Error("ØµÙŠØºØ© ØºÙŠØ± ØµØ­ÙŠØ­Ø©: ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ù…ØµÙÙˆÙØ©");
      KPIS = parsed;
      msg.style.color = "var(--ok)"; msg.textContent = "ØªÙ… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚.";
      renderKPIs();
    }catch(e){ msg.style.color = "var(--danger)"; msg.textContent = "Ø®Ø·Ø£ ÙÙŠ JSON: "+e.message; }
  };
  $("#resetKpi").onclick = ()=>{ renderKPIs(); };
}

function renderReports(){
  const body = `
    <div class="row">
      <input class="input col" type="date" id="fromDate"/>
      <input class="input col" type="date" id="toDate"/>
      <select class="select col" id="repType">
        <option value="summary">Ù…Ù„Ø®Øµ ØªÙ†ÙÙŠØ°ÙŠ</option>
        <option value="kpi">Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡</option>
        <option value="ops">ØªØ´ØºÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª</option>
      </select>
    </div>
    <div class="row" style="margin-top:10px">
      <button class="btn" id="exportCsv">ØªØµØ¯ÙŠØ± CSV</button>
      <small>Ø³ÙŠÙÙ†Ø´Ø£ Ù…Ù„Ù CSV Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙÙÙ„ØªØ±Ø©.</small>
    </div>
    <div id="repMsg" style="margin-top:8px"></div>
  `;
  $("#view").innerHTML = card("Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±", body);
  $("#exportCsv").onclick = ()=>{
    const type = $("#repType").value;
    // ØªØµØ¯ÙŠØ± Ø¨Ø³ÙŠØ·
    const rows = [["#","Ø§Ù„Ø¹Ù†ÙˆØ§Ù†","Ø§Ù„Ø¬Ù‡Ø©","Ø§Ù„Ø­Ø§Ù„Ø©","ÙˆØ³Ù…","Ø§Ù„Ù†ØªÙŠØ¬Ø©"]];
    MOCK_ITEMS.forEach(r=>rows.push([r.id,r.title,r.owner,r.status,r.tag,r.score]));
    const csv = rows.map(r=>r.map(x=>`"${String(x).replace(/"/g,'""')}"`).join(",")).join("\n");
    const blob = new Blob([csv],{type:"text/csv;charset=utf-8"});
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob); a.download = `nomu_${type}.csv`; a.click();
    $("#repMsg").innerHTML = `<span class="tag">ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</span>`;
  };
}

function renderPolicies(){
  const body = `
    <div class="row">
      <div class="col card" style="padding:12px">
        <h3>Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø·ÙÙ„</h3>
        <label style="display:flex;align-items:center;gap:8px;margin-top:6px">
          <input id="childSafe" type="checkbox" class="switch" checked />
          <span>ØªÙØ¹ÙŠÙ„ Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø­Ù…Ø§ÙŠØ©</span>
        </label>
        <small>Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø³Ø©ØŒ Ù…ÙˆØ§ÙÙ‚Ø© ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±ØŒ Ø¢Ù„ÙŠØ§Øª Ø§Ù„Ø¥Ø¨Ù„Ø§Øº.</small>
      </div>
      <div class="col card" style="padding:12px">
        <h3>Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h3>
        <div class="row" style="margin-top:6px">
          <input id="retention" class="input" style="max-width:120px" type="number" value="12"/>
          <span>Ø´Ù‡Ø±Ù‹Ø§</span>
        </div>
        <small>ÙŠÙØ­Ø°Ù ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ù…Ø§ Ù„Ù… ØªØªØ·Ù„Ø¨ Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ù„ÙØªØ±Ø© Ø£Ø·ÙˆÙ„.</small>
      </div>
      <div class="col card" style="padding:12px">
        <h3>Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¹Ø§Ø¯Ù„</h3>
        <p>ØªÙØ³ØªØ®Ø¯Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø£ØºØ±Ø§Ø¶ ØªØ´ØºÙŠÙ„ "Ù†Ù…Ùˆ" ÙÙ‚Ø· Ù…Ø¹ ØªÙØ¹ÙŠÙ„ Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù‡ÙˆÙŠØ© Ù„Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª.</p>
      </div>
    </div>
  `;
  $("#view").innerHTML = card("Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª ÙˆØ§Ù„Ø®ØµÙˆØµÙŠØ©", body);
}

function renderHelp(){
  const body = `
    <div class="row">
      <div class="col card" style="padding:12px">
        <h3>ÙƒÙŠÙ Ø£Ø¶ÙŠÙ Ù†Ø´Ø§Ø·Ù‹Ø§ØŸ</h3>
        <p>Ù…Ù† Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ØŒ Ø§Ø¶ØºØ· <b>Ø¹Ù†ØµØ± Ø¬Ø¯ÙŠØ¯</b> ÙˆØ£ÙƒÙ…Ù„ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø«Ù… Ø§Ø­ÙØ¸.</p>
      </div>
      <div class="col card" style="padding:12px">
        <h3>ØªØ­Ø¯ÙŠØ« Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡</h3>
        <p>Ø§Ù†ØªÙ‚Ù„ Ø¥Ù„Ù‰ ØªØ¨ÙˆÙŠØ¨ <b>KPIs</b> ÙˆØ¹Ø¯Ù‘Ù„ JSON Ø«Ù… Ø§Ø¶ØºØ· <b>ØªØ·Ø¨ÙŠÙ‚</b>.</p>
      </div>
      <div class="col card" style="padding:12px">
        <h3>ØªØµØ¯ÙŠØ± ØªÙ‚Ø±ÙŠØ±</h3>
        <p>Ù…Ù† ØªØ¨ÙˆÙŠØ¨ <b>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</b> Ø§Ø®ØªØ± Ø§Ù„Ù†Ø·Ø§Ù‚ ÙˆØ§Ù„Ù†ÙˆØ¹ Ø«Ù… <b>ØªØµØ¯ÙŠØ± CSV</b>.</p>
      </div>
    </div>
  `;
  $("#view").innerHTML = card("Ù…Ø±ÙƒØ² Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©", body);
}

function renderAccount(title, sections){
  const sectionTree = sections.map(s=>`<li>â€¢ ${s}</li>`).join("");
  const filters = `
    <div class="row">
      <input id="q" class="input" placeholder="Ø¨Ø­Ø«â€¦"/>
      <select id="status" class="select">
        <option value="">ÙƒÙ„ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
        <option>Ù…Ø³ÙˆØ¯Ø©</option><option>Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</option><option>Ù†Ø´Ø·</option><option>Ù…ÙƒØªÙ…Ù„</option>
      </select>
      <button class="btn" id="newItem">Ø¹Ù†ØµØ± Ø¬Ø¯ÙŠØ¯</button>
    </div>
  `;
  const tbl = renderTable(MOCK_ITEMS, {searchEl:"#q", filterEl:"#status"});
  const body = `
    <div class="row">
      <div class="col card" style="padding:12px">
        <h3>Ø§Ù„ØªÙØ±ÙŠØ¹Ø§Øª (Ø­ØªÙ‰ 4 Ù…Ø³ØªÙˆÙŠØ§Øª)</h3>
        <ul>${sectionTree}</ul>
      </div>
      <div class="col" style="min-width:360px">
        ${filters}
        ${tbl}
      </div>
    </div>
  `;
  $("#view").innerHTML = card(title, body, `<span class="tag">ØªØ´ØºÙŠÙ„ÙŠ</span>`);
  $("#newItem").onclick = ()=>alert("Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ© â€” Ø­ÙØ¸ Ù…Ø­Ù„ÙŠ Ù„Ù„ØªØ¬Ø±Ø¨Ø©");
}

function renderTable(source, opts={}){
  let data = [...source];
  const html = `
    <div class="card" style="padding:0">
      <table class="table">
        <thead>
          <tr>
            <th>#</th><th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th><th>Ø§Ù„Ù…Ø§Ù„Ùƒ/Ø§Ù„Ø¬Ù‡Ø©</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>ÙˆØ³Ù…</th><th>Ø§Ù„Ù†ØªÙŠØ¬Ø©</th>
          </tr>
        </thead>
        <tbody id="rows">
          ${data.map(r=>`
            <tr class="tr">
              <td style="padding-inline:12px">${r.id}</td>
              <td>${r.title}</td>
              <td>${r.owner}</td>
              <td>${r.status}</td>
              <td>${r.tag}</td>
              <td>${r.score}</td>
            </tr>
          `).join("")}
        </tbody>
      </table>
    </div>
  `;
  // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¨Ø­Ø«/Ø§Ù„ØªØµÙÙŠØ© Ù„Ø§Ø­Ù‚Ù‹Ø§ Ø­Ø³Ø¨ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø¥Ù† ÙˆÙØ¬Ø¯Øª
  queueMicrotask(()=>{
    const qEl = typeof opts.searchEl==="string" ? $(opts.searchEl) : null;
    const sEl = typeof opts.filterEl==="string" ? $(opts.filterEl) : null;
    const rows = $("#rows");
    function apply(){
      const q = (qEl && qEl.value)||"";
      const st = (sEl && sEl.value)||"";
      const filtered = source.filter(r =>
        (!q || r.title.includes(q) || r.owner.includes(q) || r.tag.includes(q)) &&
        (!st || r.status===st)
      );
      rows.innerHTML = filtered.map(r=>`
        <tr class="tr">
          <td style="padding-inline:12px">${r.id}</td>
          <td>${r.title}</td>
          <td>${r.owner}</td>
          <td>${r.status}</td>
          <td>${r.tag}</td>
          <td>${r.score}</td>
        </tr>
      `).join("");
    }
    if(qEl) qEl.addEventListener("input", apply);
    if(sEl) sEl.addEventListener("change", apply);
  });
  return html;
}

/* â€”â€”â€”â€”â€” Ø§Ù„Ø±Ø§ÙˆØªØ± â€”â€”â€”â€”â€” */
const routes = {
  "#/overview": renderOverview,
  "#/kpi": renderKPIs,
  "#/reports": renderReports,
  "#/policies": renderPolicies,
  "#/help": renderHelp,
  "#/acc/health": ()=>renderAccount("ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØµØ­Ø©", [
    "Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ Ø§Ù„ÙˆØ·Ù†ÙŠØ©","ØªØ®ØµÙŠØµ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯","Ù„ÙˆØ­Ø© Ù…Ø¤Ø´Ø±Ø§Øª ØµØ­ÙŠØ©","Ø³Ø¬Ù„ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø§Øª"
  ]),
  "#/acc/clinic": ()=>renderAccount("Ø§Ù„Ù…Ø±Ø§ÙƒØ² Ø§Ù„ØµØ­ÙŠØ©", [
    "Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯","Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…Ø¬ØªÙ…Ø¹","Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠØ©","Ø§Ù„ØªÙƒØ§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø£Ø­ÙŠØ§Ø¡"
  ]),
  "#/acc/education": ()=>renderAccount("ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…", [
    "Ø¨Ø±Ø§Ù…Ø¬ Ø§Ù„Ø·ÙÙˆÙ„Ø© Ø§Ù„Ù…Ø¨ÙƒØ±Ø©","Ø§Ù„Ù…Ø¯Ø±Ø¨ÙˆÙ† ÙˆØ§Ù„ÙˆØ±Ø´","Ø§Ù„ØªÙ‚ÙŠÙŠÙ… ÙˆØ§Ù„Ù…ØªØ§Ø¨Ø¹Ø©","Ø§Ù„ØªØ¹Ø§ÙˆÙ† Ù…Ø¹ Ø§Ù„ØµØ­Ø©"
  ]),
  "#/acc/neighborhood": ()=>renderAccount("Ù…Ø±Ø§ÙƒØ² Ø§Ù„Ø£Ø­ÙŠØ§Ø¡", [
    "Ø§Ù„Ø­Ù…Ù„Ø§Øª Ø§Ù„ØªÙˆØ¹ÙˆÙŠØ©","Ø§Ù„Ù…Ø±Ø§ÙÙ‚ ÙˆØ§Ù„ÙØ¹Ø§Ù„ÙŠØ©","Ø§Ù„Ù…ØªØ·ÙˆØ¹ÙˆÙ†","Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±"
  ]),
};

function navTo(hash){
  const fn = routes[hash] || routes["#/overview"];
  // ØªÙ…ÙŠÙŠØ² Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù†Ø´Ø·
  $$(".link").forEach(a=>{
    if(a.getAttribute("data-route")===hash) a.classList.add("active"); else a.classList.remove("active");
  });
  fn();
  window.scrollTo({top:0,behavior:"smooth"});
}

/* â€”â€”â€”â€”â€” ØªØ´ØºÙŠÙ„ â€”â€”â€”â€”â€” */
setupBell();
$$(".link").forEach(a=>a.onclick = (e)=>{ e.preventDefault(); location.hash = a.getAttribute("data-route"); });
window.addEventListener("hashchange", ()=>navTo(location.hash));
if(!location.hash) location.hash = "#/overview";
navTo(location.hash);
</script>
</body>
</html>
