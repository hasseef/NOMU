<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>منصة نمو NOMU — نسخة مدمجة مع لوحة المراكز</title>
<style>
  :root{
    /* هوية لونية جديدة (أخضر/فيروزي وطني) */
    --bg:#071a18;          /* خلفية داكنة مائلة للأخضر */
    --card:#0e2724;        /* بطاقات داكنة */
    --muted:#12312d;
    --pri:#22d3a6;         /* أخضر فيروزي */
    --sec:#a7f3d0;         /* أخضر فاتح ثانوي */
    --acc:#f59e0b;         /* كهرماني للتمييز */
    --danger:#ef4444;
    --ok:#22c55e;
    --text:#ecfdf5;
    --sub:#a7d6c9;
    --border:#16423d;
    --radius:18px; --pad:18px; --gap:14px; --gap-lg:22px;
    --shadow:0 10px 30px rgba(0,0,0,.35);
    --font:system-ui,"Segoe UI","Noto Kufi Arabic","Tajawal",Tahoma,Arial;
  }
  *{box-sizing:border-box}
  body{margin:0;background:linear-gradient(180deg,var(--bg),#0a201d 60%, #0a1c19);color:var(--text);font:15px/1.6 var(--font)}
  a{color:var(--pri);text-decoration:none}
  .app{display:grid;grid-template-rows:auto 1fr;min-height:100vh}
  header{position:sticky;top:0;z-index:50;background:rgba(7,26,24,.85);backdrop-filter:blur(8px);border-bottom:1px solid var(--border)}
  .topbar{display:flex;align-items:center;gap:12px;max-width:1240px;margin:auto;padding:10px var(--pad)}
  .brand-right{display:flex;align-items:center;gap:10px}
  .nomu-logo{display:flex;align-items:center;gap:10px;font-weight:900}
  .nomu-logo svg{width:36px;height:36px}
  .nomu-logo .word{letter-spacing:.5px}
  .left-logos{margin-inline-start:auto;display:flex;align-items:center;gap:10px}
  .pill-logo{display:flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;background:var(--muted);border:1px solid var(--border);color:var(--sub);font-size:12px}
  .main{max-width:1240px;margin:22px auto;display:grid;grid-template-columns:270px 1fr;gap:var(--gap-lg);padding:0 var(--pad)}
  nav{position:sticky;top:70px;height:fit-content}
  .side{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:12px}
  .group{margin:10px 0}.group h4{margin:6px 12px 8px;color:var(--sub);font-weight:600;font-size:13px}
  .link{display:flex;align-items:center;gap:10px;border-radius:12px;padding:10px 12px;color:var(--text);border:1px solid transparent}
  .link:hover{background:var(--muted);border-color:var(--border)}
  .link.active{background:linear-gradient(180deg,rgba(34,211,166,.14),rgba(34,211,166,.07));border-color:#215a53}
  .content{display:grid;gap:var(--gap-lg)}
  .cards{display:grid;grid-template-columns:repeat(12,1fr);gap:var(--gap)}
  .card{grid-column:span 4;background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:var(--pad);box-shadow:var(--shadow)}
  .wide{grid-column:span 12}.half{grid-column:span 6}.third{grid-column:span 4}
  .toolbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
  .tag{display:inline-flex;align-items:center;gap:8px;border:1px solid var(--border);background:var(--muted);padding:6px 10px;border-radius:999px;color:var(--sub);font-size:12px}
  button,.btn{background:var(--pri);color:#05201c;border:none;padding:10px 14px;border-radius:12px;font-weight:800;cursor:pointer;box-shadow:0 6px 18px rgba(34,211,166,.25)}
  .ghost{background:transparent;color:var(--text);border:1px solid var(--border)}
  .empty{border:1px dashed var(--border);border-radius:14px;padding:26px;color:var(--sub);text-align:center}
  table{width:100%;border-collapse:separate;border-spacing:0 10px}
  th,td{text-align:right;padding:12px;background:#0b221f} th{color:var(--sub);font-size:12px}
  .badge-ok{background:rgba(34,197,94,.15); border-color:#14532d}
  /* المراكز */
  .grid{display:grid;gap:var(--gap)} .grid.two{grid-template-columns:1fr 1fr} .grid.three{grid-template-columns:repeat(3,1fr)} .grid.four{grid-template-columns:repeat(4,1fr)}
  .kpi{background:linear-gradient(180deg,#0d2925,#0b221f);border:1px solid var(--border);border-radius:14px;padding:14px}
  .kpi b{display:block;font-size:24px;margin-top:6px}
  .heat{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
  .cell{border:1px solid var(--border);border-radius:12px;padding:10px;background:#0b221f;min-height:70px}
  .cell h4{margin:0;font-size:13px;color:#d2f5e7}
  .bar{height:8px;border-radius:8px;background:#0a1d1a;margin-top:8px;overflow:hidden}
  .bar>i{display:block;height:100%;background:linear-gradient(90deg,var(--pri),var(--sec));width:0}
  .list{display:grid;gap:10px}
  .ccard{border:1px solid var(--border);border-radius:14px;padding:12px;background:#0b221f}
  .ccard .title{display:flex;justify-content:space-between;gap:10px}
  .status{font-size:12px;border-radius:999px;padding:4px 8px;border:1px solid var(--border);background:#0f2d28;color:#bfeadf}
  .ok{background:rgba(34,197,94,.15)!important;color:#b7f6c7}
  .warn{background:rgba(245,158,11,.15)!important;color:#ffe5af}
  .danger{background:rgba(239,68,68,.15)!important;color:#ffc2c2}
  footer{max-width:1240px;margin:18px auto;color:#9dd9c9;text-align:center;padding:0 var(--pad)}
  @media (max-width:980px){ .main{grid-template-columns:1fr} .grid.four{grid-template-columns:1fr 1fr} .heat{grid-template-columns:1fr 1fr} }
</style>
</head>
<body>
<div class="app">
  <header>
    <div class="topbar">
      <!-- يمين الصفحة: شعار نمو -->
      <div class="brand-right">
        <div class="nomu-logo" title="منصة نمو NOMU">
          <!-- شعار نمو (SVG مبسّط: برعم/نخلة) -->
          <svg viewBox="0 0 64 64" aria-hidden="true">
            <defs>
              <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
                <stop offset="0" stop-color="#22d3a6"/><stop offset="1" stop-color="#a7f3d0"/>
              </linearGradient>
            </defs>
            <circle cx="32" cy="32" r="30" fill="none" stroke="url(#g)" stroke-width="3"/>
            <path d="M32 46c-6-8-6-16 0-24 6 8 6 16 0 24z" fill="url(#g)"/>
            <path d="M22 22c4-4 9-6 10-6s6 2 10 6" fill="none" stroke="url(#g)" stroke-width="3" stroke-linecap="round"/>
          </svg>
          <span class="word">NOMU نمو</span>
        </div>
      </div>
      <!-- يسار: رؤية 2030 + مبادرة تلبية -->
      <div class="left-logos">
        <span class="pill-logo" title="Vision 2030">
          <!-- شعار نصي مبسط لعدم توفر أصول -->
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#a7f3d0" stroke-width="2"><circle cx="12" cy="12" r="9"/></svg>
          Vision 2030
        </span>
        <span class="pill-logo" title="مبادرة تلبية">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#a7f3d0" stroke-width="2"><path d="M3 12h18M12 3v18"/></svg>
          مبادرة تلبية
        </span>
      </div>
    </div>
  </header>

  <main class="main">
    <nav>
      <div class="side">
        <div class="group">
          <h4>البدء</h4>
          <a class="link" href="#/intro" data-route>التعريفات</a>
          <a class="link" href="#/onboarding" data-route>معالج البدء</a>
        </div>
        <div class="group">
          <h4>لوحات</h4>
          <a class="link" href="#/home" data-route>الرئيسية</a>
          <a class="link" href="#/centers" data-route>المراكز الوطنية</a>
        </div>
        <div class="group">
          <h4>حسابات</h4>
          <a class="link" href="#/family" data-route>الأسرة</a>
          <a class="link" href="#/health" data-route>الصحة</a>
          <a class="link" href="#/education" data-route>التعليم</a>
          <a class="link" href="#/nonprofit" data-route>الجمعيات</a>
          <a class="link" href="#/csr" data-route>CSR</a>
          <a class="link" href="#/admin" data-route>اللجنة الوطنية</a>
        </div>
        <div class="group">
          <h4>أدوات</h4>
          <a class="link" href="#/reports" data-route>التقارير</a>
          <a class="link" href="#/settings" data-route>الإعدادات</a>
        </div>
      </div>
    </nav>

    <section class="content" id="view"></section>
  </main>

  <footer>نمو NOMU — نسخة مدمجة مخصصة بالألوان الجديدة مع شعارات رؤية 2030 ومبادرة تلبية</footer>
</div>

<script>
/* ====== أساسيات ====== */
const $=(q,root=document)=>root.querySelector(q); const $$=(q,root=document)=>Array.from(root.querySelectorAll(q));
function toast(msg){ const t=document.createElement('div'); t.style.cssText='position:fixed;left:18px;bottom:18px;background:#0a241f;color:#ecfdf5;padding:10px 14px;border-radius:12px;border:1px solid #16423d;z-index:9999'; t.textContent=msg; document.body.appendChild(t); setTimeout(()=>t.remove(),2400) }

/* ====== Router ====== */
function parseHash(){ const [path,q='']=(location.hash.replace('#','')||'/intro').split('?'); const params=Object.fromEntries(new URLSearchParams(q).entries()); return {path,params} }
const routes={'/intro':viewIntro,'/onboarding':viewOnboarding,'/home':viewHome,'/centers':viewCenters,'/family':stub('واجهة حساب الأسرة'),'\\
/health':stub('واجهة الصحة'),'/education':stub('واجهة التعليم'),'/nonprofit':stub('واجهة الجمعيات'),'/csr':stub('واجهة القطاع الخاص'),'\\
/admin':stub('واجهة اللجنة الوطنية'),'/reports':stub('التقارير'),'/settings':stub('الإعدادات')};
function router(){ const {path,params}=parseHash(); $$('a.link').forEach(a=>a.classList.toggle('active',a.getAttribute('href')===`#${path}`)); const el=$('#view'); el.innerHTML=''; (routes[path]||viewIntro)(el,params) }
window.addEventListener('hashchange',router);

/* ====== Intro & Onboarding (مختصر) ====== */
function viewIntro(root){
  root.innerHTML = `
    <div class="card wide">
      <div class="toolbar"><h2>منصة نمو — التعريفات</h2><span class="tag">هوية لونية جديدة</span></div>
      <p>منصة وطنية تربط الأسرة بالقطاعات (الصحة/التعليم/الدعم/الجمعيات/التطوع) مع حوكمة PDPL وتكاملات NPHIES/نور…</p>
      <div class="grid two">
        <div class="card"><b>رحلة الطفل</b><p>ولادة → فحوص → تدخل مبكر → جاهزية/IEP → خدمات مساندة.</p></div>
        <div class="card"><b>المراكز الوطنية</b><p>اكتشف التغطية والفجوات والربط التشغيلي عبر صفحة <a href="#/centers">المراكز</a>.</p></div>
      </div>
    </div>`;
}
function viewOnboarding(root){
  root.innerHTML = `
    <div class="card wide">
      <div class="toolbar"><h2>معالج البدء</h2></div>
      <p>اختيار الدور والمنطقة والموافقات والجهة — (نموذج مبسّط). يمكنك بدء التجربة عبر <a href="#/centers">المراكز</a>.</p>
    </div>`;
}

/* ====== لوحة رئيسية بسيطة ====== */
function kpiCard(title,value){ return `<div class="card third"><span>${title}</span><b style="display:block;font-size:26px;margin-top:6px">${value}</b></div>` }
function viewHome(root){
  root.innerHTML = `
    <div class="toolbar"><h2>لوحة مختصرة</h2><span class="tag">تجريب</span></div>
    <div class="cards">
      ${kpiCard('أطفال في السجل','134')}
      ${kpiCard('إحالات نشطة','12')}
      ${kpiCard('تمويل CSR (ر.س)','420,000')}
    </div>
    <div class="card wide"><b>ابدأ من</b> → <a href="#/centers">المراكز الوطنية</a></div>`;
}

/* ====== المراكز الوطنية (مُدمجة) ====== */
const sectors = {
  health:'الصحة', education:'التعليم', social:'الاجتماعي/الدعم', nonprofit:'الجمعيات',
  psych:'النفسية/السلوكية', training:'التدريب والتأهيل', volunteer:'التطوع'
};
let centers = [
  {id:'H-RIY-001', name:'مستشفى الملك سلمان', region:'الرياض', sector:'health', supervisor:'وزارة الصحة', status:'فعّال'},
  {id:'P-RIY-002', name:'عيادة نمو الطفل — الندى', region:'الرياض', sector:'psych', supervisor:'وزارة الصحة', status:'فعّال'},
  {id:'E-RIY-003', name:'روضة الياسمين', region:'الرياض', sector:'education', supervisor:'وزارة التعليم', status:'فعّال'},
  {id:'N-RIY-004', name:'جمعية رعاية الطفولة — الرياض', region:'الرياض', sector:'nonprofit', supervisor:'مركز القطاع غير الربحي', status:'قيد الربط'},
  {id:'S-RIY-005', name:'مركز تمكين الأسرة — غرب الرياض', region:'الرياض', sector:'social', supervisor:'وزارة الموارد البشرية', status:'فعّال'},
  {id:'T-RIY-006', name:'معهد تدريب تربوي — شمال الرياض', region:'الرياض', sector:'training', supervisor:'TVTC', status:'فعّال'},
  {id:'V-RIY-007', name:'وحدة التطوع — جامعة الملك سعود', region:'الرياض', sector:'volunteer', supervisor:'منصة العمل التطوعي', status:'فعّال'},
  {id:'H-HAI-101', name:'مركز صحي شمال حائل', region:'حائل', sector:'health', supervisor:'صحة حائل', status:'فعّال'},
  {id:'P-HAI-102', name:'مركز إرشاد أسري — حائل', region:'حائل', sector:'psych', supervisor:'جمعية نماء', status:'فعّال'},
  {id:'E-HAI-103', name:'روضة الريّان — حائل', region:'حائل', sector:'education', supervisor:'إدارة تعليم حائل', status:'قيد الربط'},
  {id:'N-HAI-104', name:'جمعية نماء للطفولة — حائل', region:'حائل', sector:'nonprofit', supervisor:'مركز القطاع غير الربحي', status:'فعّال'},
  {id:'S-HAI-105', name:'مكتب الضمان — حائل', region:'حائل', sector:'social', supervisor:'وزارة الموارد البشرية', status:'فعّال'},
  {id:'T-HAI-106', name:'مركز تدريب التربية الخاصة — حائل', region:'حائل', sector:'training', supervisor:'TVTC', status:'فعّال'},
  {id:'V-HAI-107', name:'وحدة التطوع — مستشفى حائل', region:'حائل', sector:'volunteer', supervisor:'منصة العمل التطوعي', status:'قيد الربط'},
  {id:'H-EST-201', name:'مستشفى الملك فهد الجامعي', region:'الشرقية', sector:'health', supervisor:'صحة الشرقية', status:'فعّال'},
  {id:'P-EST-202', name:'مركز تعديل السلوك — الدمام', region:'الشرقية', sector:'psych', supervisor:'جمعية أهلية', status:'قيد الربط'},
  {id:'E-EST-203', name:'إدارة تعليم الشرقية — مركز جاهزية', region:'الشرقية', sector:'education', supervisor:'وزارة التعليم', status:'فعّال'},
  {id:'N-EST-204', name:'جمعية همّة — الشرقية', region:'الشرقية', sector:'nonprofit', supervisor:'مركز القطاع غير الربحي', status:'فعّال'},
  {id:'S-EST-205', name:'مركز تنمية — الظهران', region:'الشرقية', sector:'social', supervisor:'وزارة الموارد البشرية', status:'فعّال'},
  {id:'T-EST-206', name:'معهد تدريب الوالدية — الشرقية', region:'الشرقية', sector:'training', supervisor:'TVTC', status:'فعّال'},
  {id:'V-EST-207', name:'وحدة التطوع — جامعة الإمام عبدالرحمن', region:'الشرقية', sector:'volunteer', supervisor:'منصة العمل التطوعي', status:'فعّال'},
];
const baseline = { 'الرياض': 40, 'حائل': 16, 'الشرقية': 24 };

function computeKPIs(data){
  const total = data.length;
  const active = data.filter(c=>c.status==='فعّال').length;
  const pending = data.filter(c=>c.status==='قيد الربط').length;
  const byRegion = data.reduce((acc,c)=>((acc[c.region]=(acc[c.region]||0)+1),acc),{});
  let cov=0, regions=0;
  for(const r of Object.keys(byRegion)){ cov += Math.min(1, byRegion[r]/(baseline[r]||20)); regions++; }
  const coverage = regions? Math.round((cov/regions)*100):0;
  return {total,active,pending,coverage};
}
function applyFilters(overrides={}){
  const region = overrides.region ?? $('#fRegion')?.value ?? '';
  const sector = overrides.sector ?? $('#fSector')?.value ?? '';
  const superText = ($('#fSuper')?.value||'').trim().toLowerCase();
  let data = centers.slice();
  if(region) data = data.filter(c=>c.region===region);
  if(sector) data = data.filter(c=>c.sector===sector);
  if(superText) data = data.filter(c=> (c.supervisor||'').toLowerCase().includes(superText));
  return {data, filters:{region,sector,superText}};
}
function exportCSV(){
  const f = applyFilters().data;
  const rows = [['id','name','region','sector','sector_ar','supervisor','status']].concat(
    f.map(c=>[c.id,c.name,c.region,c.sector,sectors[c.sector],c.supervisor,c.status])
  );
  const csv = rows.map(r=>r.map(x=> `"${String(x).replace(/"/g,'""')}"`).join(',')).join('\\n');
  const a=document.createElement('a'); a.href=URL.createObjectURL(new Blob([csv],{type:'text/csv;charset=utf-8;'}));
  a.download='centers_export.csv'; document.body.appendChild(a); a.click(); a.remove(); setTimeout(()=>URL.revokeObjectURL(a.href),500);
}
function cardStatusClass(status){
  if(status==='فعّال') return 'status ok';
  if(status==='قيد الربط') return 'status warn';
  return 'status danger';
}

function viewCenters(root){
  root.innerHTML = `
    <div class="toolbar">
      <h2>لوحة المراكز الوطنية</h2>
      <div class="tag">هوية مخصصة + شعارات في الهيدر</div>
    </div>
    <div class="grid two">
      <div class="card">
        <div class="grid two">
          <label>المنطقة<select id="fRegion"><option value="">الكل</option><option>الرياض</option><option>حائل</option><option>الشرقية</option></select></label>
          <label>القطاع<select id="fSector">
            <option value="">الكل</option>
            <option value="health">الصحة</option><option value="education">التعليم</option><option value="social">الاجتماعي/الدعم</option><option value="nonprofit">الجمعيات</option><option value="psych">النفسية/السلوكية</option><option value="training">التدريب والتأهيل</option><option value="volunteer">التطوع</option>
          </select></label>
        </div>
        <label style="display:block;margin-top:8px">الجهة المشرفة<input id="fSuper" placeholder="اكتب جزءًا من الاسم"/></label>
        <div style="display:flex;gap:8px;margin-top:10px">
          <button class="btn" id="btnApply">تطبيق</button>
          <button class="ghost" id="btnReset">إعادة ضبط</button>
          <button class="ghost" id="btnCSV">تصدير CSV</button>
        </div>
      </div>
      <div class="card">
        <div class="grid four">
          <div class="kpi"><span>عدد المراكز</span><b id="kCenters">—</b></div>
          <div class="kpi"><span>مراكز فعّالة</span><b id="kActive">—</b></div>
          <div class="kpi"><span>قيد الربط</span><b id="kPending">—</b></div>
          <div class="kpi"><span>معدل التغطية*</span><b id="kCoverage">—</b><div style="font-size:12px;color:#98d8c7;margin-top:6px">* تقريبي للتجربة</div></div>
        </div>
      </div>
    </div>

    <div class="card wide">
      <h3 style="margin:0 0 10px 0">خريطة تغطية مبسطة</h3>
      <div id="heat" class="heat"></div>
    </div>

    <div class="card wide">
      <h3 style="margin:0 0 10px 0">المراكز المطابقة</h3>
      <div id="list" class="list"></div>
    </div>
  `;
  // bind
  $('#btnApply').addEventListener('click', renderCentersAll);
  $('#btnReset').addEventListener('click', ()=>{ $('#fRegion').value=''; $('#fSector').value=''; $('#fSuper').value=''; renderCentersAll() });
  $('#btnCSV').addEventListener('click', exportCSV);
  renderCentersAll();
}

function renderCentersAll(){
  // KPIs
  const f = applyFilters(); const k = computeKPIs(f.data);
  $('#kCenters').textContent = k.total;
  $('#kActive').textContent = k.active;
  $('#kPending').textContent = k.pending;
  $('#kCoverage').textContent = k.coverage + '%';

  // Heat
  const container = $('#heat'); container.innerHTML='';
  const regions = ['الرياض','حائل','الشرقية'];
  const sectKeys = Object.keys(sectors);
  for(const r of regions){
    for(const s of sectKeys){
      const subset = applyFilters({region:r,sector:s}).data;
      const baselineRegion = {'الرياض':40,'حائل':16,'الشرقية':24}[r] || 20;
      const pct = Math.min(100, Math.round((subset.length / Math.max(1,(baselineRegion/sectKeys.length))) * 100));
      const cell = document.createElement('div'); cell.className='cell';
      cell.innerHTML = `<h4>${r} • ${sectors[s]}</h4><div class="bar"><i style="width:${pct}%"></i></div><div style="font-size:12px;color:#a7d6c9;margin-top:6px">${subset.length} مركز</div>`;
      container.appendChild(cell);
    }
  }

  // List
  const list = $('#list'); list.innerHTML='';
  if(!f.data.length){ list.innerHTML = '<div class="empty">لا توجد مراكز مطابقة للمرشّحات الحالية.</div>'; return; }
  for(const c of f.data){
    const el=document.createElement('div'); el.className='ccard';
    el.innerHTML = `
      <div class="title">
        <div><b>${c.name}</b><div style="color:#a7d6c9;font-size:12px">${c.region} • ${sectors[c.sector]} • ${c.supervisor}</div></div>
        <span class="status ${cardStatusClass(c.status)}">${c.status}</span>
      </div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:8px">
        <span class="tag">ID: ${c.id}</span>
        <span class="tag">زيارات شهرية: ${Math.floor(40+Math.random()*120)}</span>
        <span class="tag">إحالات نشطة: ${Math.floor(Math.random()*10)}</span>
      </div>
    `;
    list.appendChild(el);
  }
}

/* ====== Stubs ====== */
function stub(title){ return (root)=>{ root.innerHTML = `<div class="empty"><b>${title}</b><div>واجهة تجريبية.</div></div>` }}

/* ====== Init ====== */
function init(){ if(!location.hash) location.hash='#/centers'; router(); }
init();
</script>
</body>
</html>
