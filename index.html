import React, { useEffect, useMemo, useState } from "react";
import { motion } from "framer-motion";
import { Menu, X, ChevronRight, Shield, Sparkles, Banknote, Factory, Building2, GraduationCap, HeartHandshake, Users, Handshake, PhoneCall, Globe2, CreditCard, ArrowUpRight, PlayCircle, FileText, CheckCircle2, ChevronDown, ArrowRight } from "lucide-react";
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";

/**
 * منصة "نمو" – واجهة أحادية الملف (Single-File SPA)
 * — مكتملة ومهيّأة للجوال + تحسين موضع الشعار بالهاتف
 * — يحتوي الشريط العلوي (Top Ribbon) على شعاري الرؤية وتلبية فقط
 * — إزالة الشعارات من الهيدر واستبدالها بشعار المنصة وحده
 * — جعل شعار المنصة على الجهة المقابلة على الجوال (Mirrored Placement)
 * — إمكانية ربط مزوّد الدفع (نموذج قياسي Placeholder)
 * — تصميم حديث باستخدام Tailwind + shadcn/ui + framer-motion
 */

// إعدادات عامة — يمكن تغيير الروابط لاحقاً عند الدمج مع المشروع الكامل
const ASSETS = {
  // ضع روابط الشعارات الفعلية لاحقاً أو استخدم مسارات محلية ضمن /public
  vision2030: "https://upload.wikimedia.org/wikipedia/commons/thumb/4/45/Vision_2030_Logo.svg/512px-Vision_2030_Logo.svg.png",
  talabiya: "https://raw.githubusercontent.com/hasseef/assets/main/talabiya-logo.png",
  // شعار المنصة (نمو)
  nomuLogoDark: "https://raw.githubusercontent.com/hasseef/assets/main/nomu-logo-dark.png",
  nomuLogoLight: "https://raw.githubusercontent.com/hasseef/assets/main/nomu-logo-light.png",
};

// عناصر القائمة الرئيسية
const NAV_ITEMS = [
  { id: "home", label: "الرئيسية" },
  { id: "accounts", label: "الحسابات" },
  { id: "features", label: "المزايا" },
  { id: "sponsors", label: "الرعاة" },
  { id: "payments", label: "الدفع" },
  { id: "contact", label: "تواصل" },
];

// بطاقات الحسابات الستة حسب ملف حصيف (يمكن تعديل التسميات لتتطابق 100%)
const ACCOUNTS = [
  { icon: Building2, title: "القطاع الحكومي", desc: "إدارة المبادرات، الطلب على الحلول، تقارير الربط مع مستهدفات رؤية 2030." },
  { icon: Factory, title: "القطاع الخاص", desc: "تفعيل المسؤولية الاجتماعية، فرص رعاية واستثمار، إدارة الفعاليات والمرافق." },
  { icon: HeartHandshake, title: "القطاع غير الربحي", desc: "الوظائف، التطوع، المنح والتقارير، متابعة الأداء والشفافية." },
  { icon: GraduationCap, title: "الجامعات", desc: "تعزيز علمي للمشاريع، تسويق الأبحاث والبرامج، شراكات وتمويل." },
  { icon: Users, title: "الأفراد", desc: "مبادراتي، فرص تدريب وتطوع ووظائف، محفظة ومكافآت." },
  { icon: Banknote, title: "حساب المانحين", desc: "فرص المنح، محفظة وتقارير، تخصيص معايير الدعم ومتابعة الأثر." },
];

// مزوّدو الدفع (نموذج)
const PAYMENT_PROVIDERS = [
  { id: "mada", name: "Mada", logo: "https://upload.wikimedia.org/wikipedia/commons/6/6a/Mada_logo.png" },
  { id: "stcpay", name: "stc pay", logo: "https://upload.wikimedia.org/wikipedia/commons/0/04/Stc_pay_logo_2020.svg" },
  { id: "tap", name: "Tap Payments", logo: "https://seeklogo.com/images/T/tap-payments-logo-8C0C2A5D35-seeklogo.com.png" },
  { id: "hyperpay", name: "HyperPay", logo: "https://companieslogo.com/img/orig/HYPERPAY_BIG-7b8e6847.png?t=1720262647" },
];

export default function NomuApp() {
  const [open, setOpen] = useState(false);
  const [active, setActive] = useState("home");

  // مراقبة القسم النشط أثناء التمرير
  useEffect(() => {
    const handler = () => {
      const sections = NAV_ITEMS.map((i) => document.getElementById(i.id)).filter(Boolean) as HTMLElement[];
      const scrollPos = window.scrollY + 120; // تعويض الشريط + النافبار
      for (const s of sections) {
        if (scrollPos >= s.offsetTop && scrollPos < s.offsetTop + s.offsetHeight) {
          setActive(s.id);
          break;
        }
      }
    };
    window.addEventListener("scroll", handler);
    handler();
    return () => window.removeEventListener("scroll", handler);
  }, []);

  const scrollTo = (id: string) => {
    const el = document.getElementById(id);
    if (el) {
      el.scrollIntoView({ behavior: "smooth", block: "start" });
      setOpen(false);
    }
  };

  return (
    <div dir="rtl" className="min-h-screen bg-white text-gray-900">
      {/* الشريط العلوي — يحتوي شعار الرؤية + تلبية فقط */}
      <div className="w-full bg-gray-50 border-b sticky top-0 z-50">
        <div className="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
          <div className="flex h-10 items-center justify-between">
            {/* Desktop: الرؤية يسار، تلبية يمين — Mobile: يتكدس افقياً مع مسافات */}
            <div className="flex items-center gap-3 py-1">
              <img src={ASSETS.vision2030} alt="Vision 2030" className="h-6 w-auto object-contain" />
            </div>
            <div className="flex items-center gap-3 py-1">
              <img src={ASSETS.talabiya} alt="Talabiya" className="h-6 w-auto object-contain" />
            </div>
          </div>
        </div>
      </div>

      {/* النافبار — شعار المنصة فقط. على الجوال يوضع مقابل الشريط (Mirrored) */}
      <header className="sticky top-10 z-40 bg-white/80 backdrop-blur border-b">
        <div className="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
          <div className="flex h-16 items-center justify-between">
            {/* شعار المنصة: على الجوال نضعه بالجهة المقابلة مع محاذاة لتوازن الواجهة */}
            <div className="flex items-center gap-3">
              <img
                src={ASSETS.nomuLogoDark}
                alt="Nomu Platform"
                className="h-8 w-auto object-contain md:order-none order-2 md:mr-0 mr-auto"
              />
            </div>

            {/* قائمة كبيرة */}
            <nav className="hidden md:flex items-center gap-2">
              {NAV_ITEMS.map((item) => (
                <Button
                  key={item.id}
                  variant={active === item.id ? "default" : "ghost"}
                  className="rounded-full"
                  onClick={() => scrollTo(item.id)}
                >
                  {item.label}
                </Button>
              ))}
            </nav>

            {/* زر القائمة للجوال */}
            <button onClick={() => setOpen(!open)} className="md:hidden p-2">
              {open ? <X className="h-6 w-6" /> : <Menu className="h-6 w-6" />}
            </button>
          </div>
        </div>

        {/* قائمة الجوال */}
        {open && (
          <div className="md:hidden border-t bg-white">
            <div className="mx-auto max-w-7xl px-4 py-2 flex flex-col gap-1">
              {NAV_ITEMS.map((item) => (
                <button
                  key={item.id}
                  onClick={() => scrollTo(item.id)}
                  className={`flex items-center justify-between py-3 text-base ${
                    active === item.id ? "font-semibold" : ""
                  }`}
                >
                  <span>{item.label}</span>
                  <ChevronRight className="h-5 w-5" />
                </button>
              ))}
            </div>
          </div>
        )}
      </header>

      {/* الرئيسية */}
      <section id="home" className="relative overflow-hidden">
        <div className="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-16 md:py-24">
          <div className="grid md:grid-cols-2 gap-10 items-center">
            <div>
              <motion.h1
                initial={{ opacity: 0, y: 10 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ duration: 0.5 }}
                className="text-3xl sm:text-4xl md:text-5xl font-extrabold leading-tight"
              >
                منصة <span className="text-primary">نمو</span> — حاضنة حلول
                <br className="hidden sm:block" />
                تربط الجهات وتُسرّع الأثر التنموي
              </motion.h1>
              <p className="mt-4 text-gray-600 md:text-lg">
                نموذج عمل مبتكر يدعم مستهدفات رؤية 2030 عبر ربط القطاع الحكومي والخاص وغير الربحي والجامعات والأفراد والمانحين ضمن
                منظومة واحدة شفافة.
              </p>
              <div className="mt-6 flex flex-wrap gap-3">
                <Button onClick={() => scrollTo("features")}>
                  اكتشف المزايا <ArrowRight className="ml-2 h-4 w-4" />
                </Button>
                <Button variant="outline" onClick={() => scrollTo("accounts")}>تعرّف على الحسابات</Button>
                <Button variant="ghost" onClick={() => scrollTo("payments")}>بوابة الدفع</Button>
              </div>
              {/* شارة اعتماد MVPLAB/Sajilha (اختياري) */}
              <div className="mt-6 flex items-center gap-4 text-sm text-gray-500">
                <CheckCircle2 className="h-5 w-5" />
                <span>مدمج مع منتجات تقنية وطنية — MVPLAB (نموذج عرض)</span>
              </div>
            </div>
            <div className="relative">
              <motion.div
                initial={{ opacity: 0, y: 15 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ duration: 0.6, delay: 0.1 }}
              >
                <Card className="rounded-2xl shadow-xl">
                  <CardHeader>
                    <CardTitle>أهداف المنصة</CardTitle>
                  </CardHeader>
                  <CardContent className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    {[{
                      icon: Shield, text: "تعزيز فاعلية الحكومة وشفافية العمل"
                    }, {
                      icon: Sparkles, text: "تمكين الحلول ورفع جودة المشاريع"
                    }, {
                      icon: Handshake, text: "تكامل القطاعات وشراكات مستدامة"
                    }, { icon: Globe2, text: "تحفيز الاستثمار المجتمعي والتوسع" }].map((f, idx) => (
                      <div key={idx} className="flex items-start gap-3">
                        <f.icon className="h-5 w-5 mt-1" />
                        <p className="text-gray-700">{f.text}</p>
                      </div>
                    ))}
                  </CardContent>
                </Card>
              </motion.div>
            </div>
          </div>
        </div>
      </section>

      {/* الحسابات */}
      <section id="accounts" className="bg-gray-50">
        <div className="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-16">
          <h2 className="text-2xl md:text-3xl font-bold mb-8">الحسابات</h2>
          <div className="grid sm:grid-cols-2 lg:grid-cols-3 gap-6">
            {ACCOUNTS.map(({ icon: Ic, title, desc }) => (
              <Card key={title} className="rounded-2xl">
                <CardHeader className="flex-row items-center gap-3">
                  <Ic className="h-6 w-6" />
                  <CardTitle className="text-lg">{title}</CardTitle>
                </CardHeader>
                <CardContent>
                  <p className="text-gray-600 leading-relaxed">{desc}</p>
                  <div className="mt-4">
                    <Button variant="ghost" className="px-0" onClick={() => alert(`فتح دليل حساب: ${title}`)}>
                      فتح الدليل التفصيلي <ArrowUpRight className="mr-1 h-4 w-4" />
                    </Button>
                  </div>
                </CardContent>
              </Card>
            ))}
          </div>
        </div>
      </section>

      {/* المزايا */}
      <section id="features" className="bg-white">
        <div className="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-16">
          <div className="flex items-center justify-between mb-8">
            <h2 className="text-2xl md:text-3xl font-bold">مزايا المنصة</h2>
            <Button variant="outline" onClick={() => alert("تحميل الملف التعريفي")}>تحميل الملف التعريفي</Button>
          </div>
          <div className="grid md:grid-cols-3 gap-6">
            {[{
              title: "ربط علمي وتنفيذي", text: "مشاركة الجامعات في تعزيز المشاريع علمياً وتنفيذياً لرفع الجودة وترشيد الإنفاق.", icon: GraduationCap
            }, {
              title: "تقارير أثر وشفافية", text: "لوحات معلومات للأثر التنموي وربط بالمستهدفات الوطنية.", icon: FileText
            }, {
              title: "تجربة مرنة للجوال", text: "تصميم متجاوب بالكامل، مع معالجة موضع الشعار على الهواتف.", icon: PhoneCall
            }].map((f) => (
              <Card key={f.title} className="rounded-2xl">
                <CardHeader className="flex-row items-center gap-3">
                  <f.icon className="h-6 w-6" />
                  <CardTitle className="text-lg">{f.title}</CardTitle>
                </CardHeader>
                <CardContent>
                  <p className="text-gray-600">{f.text}</p>
                </CardContent>
              </Card>
            ))}
          </div>
        </div>
      </section>

      {/* الرعاة */}
      <section id="sponsors" className="bg-gray-50">
        <div className="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-16">
          <h2 className="text-2xl md:text-3xl font-bold mb-8">شركاء ورعاة</h2>
          <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-6 items-center">
            {[ASSETS.vision2030, ASSETS.talabiya, ASSETS.nomuLogoDark, ASSETS.nomuLogoLight].map((src, i) => (
              <div key={i} className="p-4 bg-white rounded-xl border flex items-center justify-center">
                <img src={src} alt={`sponsor-${i}`} className="h-10 w-auto object-contain" />
              </div>
            ))}
          </div>
          <div className="mt-6">
            <Button onClick={() => alert("نموذج اتفاقية رعاية")}>اطلب رعاية</Button>
          </div>
        </div>
      </section>

      {/* الدفع */}
      <section id="payments" className="bg-white">
        <div className="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-16">
          <div className="flex items-center justify-between mb-8">
            <h2 className="text-2xl md:text-3xl font-bold">بوابة الدفع</h2>
            <Button variant="outline" onClick={() => alert("فتح إعدادات التكامل مع مزوّد الدفع")}>إعدادات التكامل</Button>
          </div>

          <div className="grid md:grid-cols-3 gap-6">
            {PAYMENT_PROVIDERS.map((p) => (
              <Card key={p.id} className="rounded-2xl">
                <CardHeader className="flex-row items-center gap-3">
                  <img src={p.logo} className="h-6 w-auto object-contain" alt={p.name} />
                  <CardTitle className="text-lg">{p.name}</CardTitle>
                </CardHeader>
                <CardContent>
                  <p className="text-gray-600">تكامل قياسي عبر Webhooks وواجهة REST. يدعم مدفوعات المنح والرعايات والاشتراكات.</p>
                  <div className="mt-4 flex items-center gap-2">
                    <Button onClick={() => alert(`تفعيل ${p.name}`)}>
                      تفعيل <CreditCard className="mr-2 h-4 w-4" />
                    </Button>
                    <Button variant="ghost" onClick={() => alert("اختبار عملية دفع (Sandbox)")}>اختبار Sandbox</Button>
                  </div>
                </CardContent>
              </Card>
            ))}
          </div>

          {/* نموذج دفع مبسّط */}
          <div className="mt-10">
            <Card className="rounded-2xl">
              <CardHeader>
                <CardTitle>تبرع/رعاية سريعة</CardTitle>
              </CardHeader>
              <CardContent>
                <form
                  onSubmit={(e) => {
                    e.preventDefault();
                    alert("تم إرسال العملية إلى بوابة الاختبار — سيتم الاستبدال بالتكامل الفعلي");
                  }}
                  className="grid md:grid-cols-4 gap-4"
                >
                  <input className="border rounded-xl p-3" required placeholder="الاسم الكامل" />
                  <input className="border rounded-xl p-3" required type="email" placeholder="البريد الإلكتروني" />
                  <input className="border rounded-xl p-3" required type="number" min={1} placeholder="المبلغ (ر.س)" />
                  <Button type="submit" className="rounded-xl">إتمام الدفع</Button>
                </form>
              </CardContent>
            </Card>
          </div>
        </div>
      </section>

      {/* تواصل */}
      <section id="contact" className="bg-gray-50">
        <div className="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-16">
          <div className="grid md:grid-cols-2 gap-8">
            <div>
              <h2 className="text-2xl md:text-3xl font-bold mb-4">تواصل معنا</h2>
              <p className="text-gray-600 mb-6">للاستفسارات والشراكات وطلبات الرعاية، يسعدنا تواصلكم.</p>
              <div className="space-y-3 text-gray-700">
                <div className="flex items-center gap-2"><PhoneCall className="h-5 w-5" /> 9200 000 00</div>
                <div className="flex items-center gap-2"><Globe2 className="h-5 w-5" /> hasseef.sa</div>
              </div>
            </div>
            <Card className="rounded-2xl">
              <CardHeader>
                <CardTitle>نموذج التواصل</CardTitle>
              </CardHeader>
              <CardContent>
                <form onSubmit={(e) => { e.preventDefault(); alert("تم الاستلام — سنعاود التواصل"); }} className="grid grid-cols-1 gap-4">
                  <input className="border rounded-xl p-3" required placeholder="الاسم" />
                  <input className="border rounded-xl p-3" required type="email" placeholder="البريد الإلكتروني" />
                  <textarea className="border rounded-xl p-3" rows={4} placeholder="رسالتك"></textarea>
                  <Button type="submit" className="rounded-xl">إرسال</Button>
                </form>
              </CardContent>
            </Card>
          </div>
        </div>
      </section>

      <footer className="border-t py-8">
        <div className="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 text-sm text-gray-500 flex flex-col md:flex-row items-center justify-between gap-3">
          <span>© {new Date().getFullYear()} منصة نمو – جميع الحقوق محفوظة</span>
          <div className="flex items-center gap-4">
            <a href="#" className="hover:text-gray-700">سياسة الخصوصية</a>
            <a href="#" className="hover:text-gray-700">الشروط</a>
          </div>
        </div>
      </footer>

      {/* أنماط دقيقة لضمان تموضع الشعار في الجوال مقابل شعاري الشريط */}
      <style>{`
        @media (max-width: 767px) {
          header .h-16 > div:first-child img { order: 2; margin-right: auto; }
        }
      `}</style>
    </div>
  );
}
