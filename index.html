<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>منصة نمو NOMU — v3.6 (كامل المنصة)</title>
<style>
  :root{
    --bg:#f7fbff; --paper:#ffffff; --brand:#16a34a; --accent:#f59e0b; --ink:#0f172a; --sub:#475569;
    --muted:#f1f5f9; --border:#e2e8f0; --radius:18px; --pad:18px; --gap:14px; --gap-lg:22px;
    --shadow:0 10px 30px rgba(2,12,27,.06); --font:"Tajawal","Noto Kufi Arabic",system-ui,-apple-system,"Segoe UI",Arial;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--ink);font:15px/1.7 var(--font)}
  a{color:#0ea5e9;text-decoration:none}
  header{position:sticky;top:0;z-index:40;background:#ffffffd9;backdrop-filter:blur(6px);border-bottom:1px solid var(--border)}
  .topbar{max-width:1240px;margin:auto;padding:10px var(--pad);display:flex;align-items:center;gap:12px}
  .nomu-logo{width:40px;height:40px;border-radius:12px;background:conic-gradient(from 180deg, #22c55e, #86efac, #34d399, #22c55e); box-shadow:0 6px 16px rgba(16,185,129,.25)}
  .nomu-badge b{font-size:18px}
  .left-logos{margin-inline-start:auto;display:flex;align-items:center;gap:8px}
  .pill-logo{display:flex;align-items:center;gap:8px;background:var(--muted);border:1px solid var(--border);border-radius:999px;padding:6px 10px}
  .pill-logo img{height:28px;display:block}
  .main{max-width:1240px;margin:22px auto;display:grid;grid-template-columns:280px 1fr;gap:var(--gap-lg);padding:0 var(--pad)}
  nav .side{position:sticky;top:70px;background:var(--paper);border:1px solid var(--border);border-radius:var(--radius);padding:12px;box-shadow:var(--shadow)}
  .group h4{margin:10px 8px;color:var(--sub);font-size:13px}
  .link{display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:12px;color:var(--ink);border:1px solid transparent}
  .link:hover{background:var(--muted);border-color:var(--border)}
  .link.active{background:linear-gradient(180deg,#ecfdf5,#e7f9f0);border-color:#befae0}
  .content{display:grid;gap:var(--gap-lg)}
  .card{background:var(--paper);border:1px solid var(--border);border-radius:var(--radius);padding:var(--pad);box-shadow:var(--shadow)}
  .toolbar{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
  .tag{display:inline-flex;align-items:center;gap:8px;border:1px solid var(--border);background:#f0fdf4;color:#14532d;padding:6px 10px;border-radius:999px;font-size:12px}
  button,.btn{background:var(--brand);color:#052e1d;border:none;padding:10px 14px;border-radius:12px;font-weight:800;cursor:pointer;box-shadow:0 6px 18px rgba(34,197,94,.25)}
  .ghost{background:transparent;color:var(--ink);border:1px solid var(--border)}
  .grid{display:grid;gap:var(--gap)} .two{grid-template-columns:1fr 1fr} .three{grid-template-columns:repeat(3,1fr)} .four{grid-template-columns:repeat(4,1fr)}
  table{width:100%;border-collapse:separate;border-spacing:0 10px} th,td{text-align:right;padding:10px;background:#fcfdff} th{color:#64748b;font-size:12px}
  .pill{display:inline-flex;gap:6px;padding:6px 10px;border:1px solid var(--border);border-radius:999px;background:#f8fafc;font-size:12px;margin:2px}
  .note{font-size:12px;color:#64748b}
  .form label{display:block;margin:6px 0 4px}
  .form input,.form select,.form textarea{width:100%;padding:10px;border:1px solid var(--border);border-radius:10px;background:#fff}
  .tabs{display:flex;gap:8px;flex-wrap:wrap;border-bottom:1px solid var(--border);padding-bottom:8px;margin-bottom:8px}
  .tab{padding:8px 12px;border:1px solid var(--border);border-bottom:none;border-radius:10px 10px 0 0;background:#f8fafc;cursor:pointer}
  .tab.active{background:#fff;border-color:#22c55e}
  .tabpanel{border:1px solid var(--border);border-radius:0 12px 12px 12px;padding:12px;background:#fff}
  .kpi{border:1px solid var(--border);border-radius:14px;padding:14px;background:#f8fffb}
  .kpi b{display:block;font-size:22px;margin-top:6px}
  .callout{background:#f0f9ff;border:1px solid #bae6fd;border-radius:12px;padding:10px}
  .danger{background:#fff1f2;border:1px solid #fecdd3}
  footer{max-width:1240px;margin:24px auto 40px;color:#64748b;text-align:center;padding:0 var(--pad)}
  @media (max-width:980px){ .main{grid-template-columns:1fr} .four{grid-template-columns:1fr 1fr} }
</style>
</head>
<body>
<header>
  <div class="topbar">
    <div class="nomu-badge">
      <div class="nomu-logo" aria-hidden="true"></div>
      <div><b>NOMU — منصة نمو</b><div style="font-size:12px;color:#0f766e">منصة وطنية للطفولة المبكرة</div></div>
    </div>
    <div class="left-logos">
      <!-- شعارات Base64 (SVG) تعمل مباشرة — استبدلها لاحقًا بشعاركم الرسمي إن رغبت -->
      <span class="pill-logo" title="Vision 2030">
        <img alt="Vision 2030" src='data:image/svg+xml;utf8,<?xml version="1.0" encoding="UTF-8"?><svg xmlns="http://www.w3.org/2000/svg" width="140" height="36"><rect x="1" y="5" rx="12" width="138" height="26" fill="%23f1f5f9" stroke="%23cbd5e1"/><text x="70" y="24" text-anchor="middle" font-size="14" font-family="Tajawal,Arial" fill="%230f172a">Vision 2030</text></svg>'/>
      </span>
      <span class="pill-logo" title="مبادرة تلبية">
        <img alt="Talbiya" src='data:image/svg+xml;utf8,<?xml version="1.0" encoding="UTF-8"?><svg xmlns="http://www.w3.org/2000/svg" width="140" height="36"><rect x="1" y="5" rx="12" width="138" height="26" fill="%23f1f5f9" stroke="%23cbd5e1"/><text x="70" y="24" text-anchor="middle" font-size="14" font-family="Tajawal,Arial" fill="%230f172a">%D9%85%D8%A8%D8%A7%D8%AF%D8%B1%D8%A9%20%D8%AA%D9%84%D8%A8%D9%8A%D8%A9</text></svg>'/>
      </span>
    </div>
  </div>
</header>

<main class="main">
  <nav>
    <div class="side">
      <div class="group">
        <h4>التعاريف</h4>
        <a class="link" href="#/intro">عن المنصة</a>
        <a class="link" href="#/kpi-registry">سجل تعريفات KPI</a>
      </div>
      <div class="group">
        <h4>الحسابات</h4>
        <a class="link" href="#/acc/health">وزارة الصحة</a>
        <a class="link" href="#/acc/clinic">المراكز الصحية</a>
        <a class="link" href="#/acc/education">وزارة التعليم</a>
        <a class="link" href="#/acc/neighborhood">مراكز الأحياء</a>
        <a class="link" href="#/acc/nonprofit">الجمعيات</a>
        <a class="link" href="#/acc/hr">الموارد البشرية</a>
        <a class="link" href="#/acc/csr">القطاع الخاص</a>
        <a class="link" href="#/acc/family">الأسرة</a>
        <a class="link" href="#/acc/admin">اللجنة الوطنية</a>
      </div>
      <div class="group">
        <h4>تشغيل</h4>
        <a class="link" href="#/dispatch">موزّع المواعيد الذكي</a>
        <a class="link" href="#/ops">لوحة تشغيل المراكز</a>
      </div>
      <div class="group">
        <h4>الاستدامة</h4>
        <a class="link" href="#/sponsors">بوابة الرعاة</a>
      </div>
      <div class="group">
        <h4>الأمن والربط</h4>
        <a class="link" href="#/sso">SSO نفاذ</a>
        <a class="link" href="#/rbac">RBAC</a>
        <a class="link" href="#/config">مركز الإعدادات</a>
      </div>
      <div class="group">
        <h4>سياسات ومساعدة</h4>
        <a class="link" href="#/privacy">سياسة الخصوصية</a>
        <a class="link" href="#/child-protect">حماية الطفل</a>
        <a class="link" href="#/help">مركز المساعدة</a>
        <a class="link" href="#/terms">الشروط والأحكام</a>
      </div>
      <div class="group">
        <h4>أدوات</h4>
        <a class="link" href="#/export">تصدير</a>
        <a class="link" href="#/apidocs">API Docs</a>
      </div>
    </div>
  </nav>

  <section class="content" id="view"></section>
</main>

<footer>نمو NOMU — v3.6 (كامل المنصة: حسابات + خدمات + تبويبات + تشغيل + سياسات + ربط + استدامة)</footer>

<script>
/* ====== Helpers ====== */
const $=(q,root=document)=>root.querySelector(q);
const $$=(q,root=document)=>Array.from(root.querySelectorAll(q));
function route(){ const p=location.hash.slice(1)||'/intro'; $$('a.link').forEach(a=>a.classList.toggle('active', a.getAttribute('href')===`#${p}`)); (routes[p]||intro)(); }
window.addEventListener('hashchange',route);
const downloadJSON=(name,obj)=>{ const a=document.createElement('a'); a.href=URL.createObjectURL(new Blob([JSON.stringify(obj,null,2)],{type:'application/json'})); a.download=name; a.click(); };
const downloadCSV=(name,rows)=>{ const csv=rows.map(r=>r.map(v=>`"${(v??'').toString().replace(/"/g,'""')}"`).join(',')).join('\n'); const a=document.createElement('a'); a.href=URL.createObjectURL(new Blob([csv],{type:'text/csv'})); a.download=name; a.click(); };

/* ====== Config (Endpoints + Field Maps) ====== */
const DEFAULT_CONFIG={
  sso:{ issuer:'https://nafath.example.gov.sa', authorize_url:'https://nafath.example.gov.sa/authorize', token_url:'https://nafath.example.gov.sa/token', client_id:'NOMU-CLIENT-ID', redirect_uri:'https://nomu.gov.sa/callback' },
  apis:{
    nphies_base:'https://api.nphies.sa/v1',
    noor_base:'https://api.noor.moe.sa/v1',
    csr_base:'https://api.csr.sa/v1',
    internal:{
      health:'/api/health', clinic:'/api/clinic', education:'/api/education', neighborhood:'/api/neighborhood',
      nonprofit:'/api/nonprofit', hr:'/api/hr', csr:'/api/csr', family:'/api/family', admin:'/api/admin',
      dispatch:'/api/dispatch'
    }
  },
  field_maps:{
    health:{ mrn:'mrn', dev_result:'development_result', phq_score:'phq_total', icd10:'icd10_code' },
    clinic:{ specialty:'specialty', appt_datetime:'appointment_at' },
    education:{ readiness_score:'readiness_score', iep_json:'iep_payload', school_name:'school_name' },
    neighborhood:{ program:'program_name', capacity:'capacity' },
    nonprofit:{ program:'program', sessions:'sessions' },
    hr:{ support_type:'support_type', amount:'monthly_amount', eligibility:'eligibility_status' },
    csr:{ company:'company_name', amount:'pledge_amount', purpose:'purpose', region:'region' },
    family:{ guardian_id:'guardian_national_id', region:'region', consent:'consent_flag' },
    admin:{ policy_decision:'policy_text', kpi_def:'kpi_definition' }
  }
};
const loadConfig=()=>{ try{ return JSON.parse(localStorage.getItem('nomu_config')||'null') || DEFAULT_CONFIG }catch(e){ return DEFAULT_CONFIG } };
const saveConfig=(cfg)=>{ localStorage.setItem('nomu_config', JSON.stringify(cfg)); alert('تم حفظ الإعدادات'); };

/* ====== RBAC ====== */
let RBAC={ roles:{
  'health.practitioner':['child.read','health.write','referral.send','appointment.manage','kpi.view'],
  'clinic.staff':['child.read','appointment.manage','referral.accept','kpi.view'],
  'education.specialist':['child.read','education.write','referral.accept','kpi.view'],
  'neighborhood.coordinator':['program.manage','booking.manage','referral.accept','kpi.view'],
  'nonprofit.worker':['child.read','service.write','referral.accept','kpi.view'],
  'admin.national':['kpi.view','kpi.define','policy.write','audit.read'],
  'family.guardian':['child.own','consent.grant','appointment.book']
}};
const checkPerm=(role,perm,consent=true)=> (RBAC.roles[role]||[]).includes(perm) && (perm!=='child.read' || consent || role==='admin.national');

/* ====== لوحة عن المنصة ====== */
function intro(){
  const v=$('#view');
  v.innerHTML = `
  <div class="card">
    <div class="toolbar"><h2>عن منصة نمو (NOMU)</h2><span class="tag">منصة وطنية للطفولة المبكرة</span></div>
    <p><b>منصة نمو</b> تعزز التكامل بين الصحة والتعليم والدعم الاجتماعي، عبر نموذج إحالات موحد، ولوحات مؤشرات وطنية، وسياسات PDPL، وشراكات استدامة (CSR).</p>
    <div class="grid four">
      <div class="kpi"><div>تغطية الفحص النمائي</div><b id="k1">—%</b><span class="note">هدف 2025: 80%</span></div>
      <div class="kpi"><div>الجاهزية المدرسية</div><b id="k2">—%</b><span class="note">هدف 2025: 75%</span></div>
      <div class="kpi"><div>متوسط زمن الإحالة</div><b id="k3">— يوم</b><span class="note">هدف: ≤7 أيام</span></div>
      <div class="kpi"><div>تمويل CSR</div><b id="k4">— ر.س</b><span class="note">سنوي</span></div>
    </div>
  </div>`;
}

/* ====== سجل تعريفات KPI ====== */
const KPI_REGISTRY=[
  { id:'DEV_SCREEN', name:'نسبة تغطية الفحص النمائي', owner:'وزارة الصحة — صحة الأم والطفل', formula:'المفحوصون ÷ المستهدفون ×100', period:'شهري', source:'HealthAssessment' },
  { id:'SCHOOL_READY', name:'نسبة الجاهزية المدرسية', owner:'وزارة التعليم — الطفولة المبكرة', formula:'جاهزون ÷ إجمالي 5–6 ×100', period:'فصلي', source:'EducationPlan' },
  { id:'REF_TTR', name:'زمن الإحالة (يوم)', owner:'اللجنة الوطنية', formula:'متوسط (قبول − فتح)', period:'شهري', source:'Referral' },
  { id:'WAIT', name:'متوسط انتظار الخدمة', owner:'الجهة المقدِّمة', formula:'متوسط (أول جلسة − القبول)', period:'شهري', source:'ServiceSession' },
  { id:'CSR_FUNDS', name:'تمويل CSR', owner:'القطاع الخاص + المنصة', formula:'التعهدات المؤكدة + المحوّل', period:'ربع سنوي', source:'CSRCommitment' },
  { id:'ACTIVE_REF', name:'الإحالات النشطة', owner:'اللجنة الوطنية', formula:'المفتوحة − المغلقة', period:'يومي', source:'Referral' }
];
function kpiRegistryPage(){
  const v=$('#view');
  v.innerHTML=`
  <div class="card">
    <div class="toolbar"><h2>سجل تعريفات المؤشرات الوطنية (KPI)</h2><button class="ghost" id="dl">تنزيل JSON</button></div>
    <table><thead><tr><th>المؤشر</th><th>المالك</th><th>الصيغة</th><th>الفترة</th><th>المصدر</th></tr></thead>
      <tbody>${KPI_REGISTRY.map(k=>`<tr><td><b>${k.name}</b><div class='note'>${k.id}</div></td><td>${k.owner}</td><td>${k.formula}</td><td>${k.period}</td><td>${k.source}</td></tr>`).join('')}</tbody>
    </table>
  </div>`;
  $('#dl').onclick=()=>downloadJSON('kpi_registry.json', KPI_REGISTRY);
}

/* ====== بيانات المراكز + خوارزمية التوزيع ====== */
const CENTERS=[
  { id:'CLN-001', name:'مركز صحي حي الازدهار', type:'clinic', region:'الرياض', specialty:['نمائي','تخاطب'], capacityDay:24, bookedToday:8, avgVisitMin:30, slaDays:7 },
  { id:'CLN-002', name:'مركز صحي حي الشاطئ', type:'clinic', region:'الشرقية', specialty:['نمائي','وظيفي'], capacityDay:18, bookedToday:15, avgVisitMin:40, slaDays:5 },
  { id:'NHB-101', name:'مركز حي التعاون', type:'neighborhood', region:'الرياض', specialty:['توعية','فرز أولي'], capacityDay:40, bookedToday:10, avgVisitMin:20, slaDays:3 },
  { id:'NHB-102', name:'مركز حي العليا', type:'neighborhood', region:'الرياض', specialty:['توعية','فرز أولي'], capacityDay:35, bookedToday:34, avgVisitMin:20, slaDays:3 },
  { id:'NGO-501', name:'جمعية نماء الطفولة', type:'nonprofit', region:'الرياض', specialty:['تدخل مبكر','تخاطب'], capacityDay:22, bookedToday:6, avgVisitMin:45, slaDays:10 }
];
const QUEUE=[]; // قائمة انتظار المواعيد

function occPct(c){ return Math.round((c.bookedToday / Math.max(1,c.capacityDay))*100); }
function estWaitDays(c){ const overflow=Math.max(0, c.bookedToday - c.capacityDay); return overflow>0 ? Math.ceil(overflow / Math.max(1,c.capacityDay)) : 0; }
function pickCenter({region, need, maxSlaDays=14}){
  const candidates = CENTERS.filter(c=> (c.region===region) && (need==='فرز أولي' ? true : c.specialty.includes(need)));
  if(!candidates.length) return null;
  const scored = candidates.map(c=>{
    const occ = c.bookedToday / Math.max(1,c.capacityDay);
    const occScore = 1 - Math.min(1,occ);
    const slaScore = Math.max(0, (maxSlaDays - c.slaDays)/maxSlaDays);
    const score = occScore*0.6 + slaScore*0.4;
    return {c, score};
  }).sort((a,b)=>b.score-a.score);
  return scored[0]?.c || null;
}

/* ====== الموزّع الذكي ====== */
function dispatchPage(){
  const v=$('#view');
  v.innerHTML = `
  <div class="card">
    <div class="toolbar"><h2>الموزّع الذكي للمواعيد</h2><span class="tag">توزيع حسب المنطقة/التخصص/الإشغال/SLA</span></div>
    <div class="grid two form">
      <label>هوية الطفل/الملف<input id="childId" placeholder="Child-XXXX"/></label>
      <label>منطقة الخدمة
        <select id="region"><option>الرياض</option><option>الشرقية</option></select>
      </label>
      <label>نوع الحاجة
        <select id="need"><option>نمائي</option><option>تخاطب</option><option>وظيفي</option><option>فرز أولي</option></select>
      </label>
      <label>أولوية الحالة
        <select id="priority"><option>عادية</option><option>عاجلة</option></select>
      </label>
      <label>الـ SLA الأقصى (أيام)<input id="sla" type="number" value="14"/></label>
      <label>الدور (RBAC)
        <select id="role"><option>clinic.staff</option><option>health.practitioner</option><option>neighborhood.coordinator</option><option>admin.national</option></select>
      </label>
    </div>
    <div style="margin-top:8px">
      <button class="btn" id="allocate">توزيع ذكي</button>
      <button class="ghost" id="exportQueue">تصدير CSV</button>
    </div>
    <pre id="out" class="callout" style="white-space:pre-wrap;margin-top:10px"></pre>
  </div>
  <div class="card">
    <div class="toolbar"><h3>الطلبات/الانتظار</h3><span class="tag">قائمة ديناميكية</span></div>
    <div id="queueList"></div>
  </div>`;
  const renderQueue=()=>{
    if(!QUEUE.length){ $('#queueList').innerHTML = '<div class="note">لا توجد طلبات بعد.</div>'; return; }
    $('#queueList').innerHTML = `
      <table><thead><tr><th>Request</th><th>المنطقة</th><th>الحاجة</th><th>الأولوية</th><th>المركز</th><th>الحالة</th></tr></thead>
      <tbody>${QUEUE.map(q=>`<tr>
        <td>${q.reqId}</td><td>${q.region}</td><td>${q.need}</td><td>${q.priority}</td>
        <td>${q.assignedTo? q.assignedTo.name+' ('+q.assignedTo.id+')':'—'}</td><td>${q.status}</td>
      </tr>`).join('')}</tbody></table>`;
  };
  renderQueue();

  $('#allocate').onclick=()=>{
    const role=$('#role').value;
    if(!checkPerm(role,'appointment.manage')){ $('#out').textContent='⛔ لا تملك صلاحية حجز/توزيع (appointment.manage).'; return; }
    const req={
      reqId:'REQ-'+Math.random().toString(36).slice(2,8).toUpperCase(),
      childId:$('#childId').value || 'Child-—',
      region:$('#region').value, need:$('#need').value, priority:$('#priority').value,
      slaDays: parseInt($('#sla').value,10)||14, status:'جديد'
    };
    const target = pickCenter(req);
    if(target){
      if(occPct(target)<100){
        target.bookedToday += 1;
        req.assignedTo = target; req.status = 'محجوز اليوم';
        $('#out').textContent = `✅ تم الحجز لدى: ${target.name} — إشغال الآن: ${occPct(target)}% • انتظار تقديري: ${estWaitDays(target)} يوم`;
      }else{
        req.assignedTo = target; req.status = 'انتظار بالمركز';
        $('#out').textContent = `⌛ المركز ممتلئ اليوم — أُضيف الطلب إلى الانتظار لدى: ${target.name} • تقدير: ${estWaitDays(target)} يوم`;
      }
    }else{
      req.status = 'انتظار عام (لا يوجد مركز مطابق)';
      $('#out').textContent = '⚠️ لا يوجد مركز مناسب — تمت إضافة الطلب للانتظار العام للمراجعة.';
    }
    QUEUE.unshift(req);
    renderQueue();
  };

  $('#exportQueue').onclick=()=>{
    const rows=[['reqId','childId','region','need','priority','assignedCenterId','assignedCenterName','status']];
    QUEUE.forEach(q=>rows.push([q.reqId,q.childId,q.region,q.need,q.priority,q.assignedTo?.id||'',q.assignedTo?.name||'',q.status]));
    downloadCSV('dispatch_queue.csv',rows);
  };
}

/* ====== لوحة تشغيل المراكز ====== */
function opsPage(){
  const v=$('#view');
  const cards = CENTERS.map(c=>`
    <div class="card">
      <div class="toolbar"><h3>${c.name}</h3><span class="tag">${c.type}</span></div>
      <div class="grid two">
        <div class="kpi"><div>الإشغال</div><b>${occPct(c)}%</b><span class="note">اليوم • سعة ${c.capacityDay}</span></div>
        <div class="kpi"><div>انتظار تقديري</div><b>${estWaitDays(c)} يوم</b><span class="note">SLA: ${c.slaDays} أيام</span></div>
      </div>
      <div class="note">التخصصات: ${c.specialty.join('، ')} • المنطقة: ${c.region}</div>
    </div>
  `).join('');
  v.innerHTML = `
    <div class="card">
      <div class="toolbar"><h2>لوحة تشغيل المراكز</h2><span class="tag">الطاقة الاستيعابية والـSLA</span></div>
      <div class="grid two">${cards}</div>
    </div>
    <div class="card danger">
      <b>توصية تشغيلية:</b>
      <p>اعتماد نموذج <u>هجين</u>: المراكز الصحية للحجز السريري والتدخل المتخصّص؛ مراكز الأحياء للفرز الأولي والبرامج النمائية الخفيفة بإشراف فني. 
      يقلل ذلك ضغط التوظيف الحكومي عبر التعاقد مع الجمعيات والاستشارات عن بُعد والتدريب الموجه (Task-shifting).</p>
    </div>`;
}

/* ====== الحسابات (تبويبات + حقول) ====== */
const ACCOUNTS={
  health:{ title:'وزارة الصحة', menus:['سجل الفحوص','التدخل المبكر','الإحالات','المواعيد','مطالبات NPHIES','تقارير'], fieldsByTab:{
      'سجل الفحوص':[
        {label:'MRN',key:'mrn'},{label:'نتيجة الفحص النمائي',key:'dev_result'},{label:'PHQ-2/9',key:'phq_score'},{label:'ICD-10',key:'icd10'}
      ],
      'التدخل المبكر':[
        {label:'نوع التدخل',key:'intervention_type'},{label:'عدد الجلسات',key:'sessions'},{label:'موعد المتابعة',key:'followup_date'}
      ],
      'الإحالات':[
        {label:'جهة الإحالة',key:'ref_to'},{label:'أولوية الحالة',key:'priority'},{label:'مرفقات (رابط)',key:'attachments'}
      ],
      'المواعيد':[
        {label:'هوية الطفل',key:'childId'},{label:'المنطقة',key:'region'},{label:'الحاجة',key:'need'},{label:'أولوية',key:'prio'}
      ],
      'مطالبات NPHIES':[
        {label:'رقم المطالبة',key:'claim_id'},{label:'الحالة',key:'claim_status'}
      ],
      'تقارير':[ ]
    ], adapter:'/api/health' },
  clinic:{ title:'المراكز الصحية', menus:['المواعيد','الإحالات','الخدمات','المخزون','التقارير'], fieldsByTab:{
      'المواعيد':[
        {label:'سجل الطفل',key:'mrn'},{label:'التخصص',key:'specialty'},{label:'موعد (تاريخ/ساعة)',key:'appt_datetime'}
      ],
      'الإحالات':[
        {label:'من جهة',key:'ref_from'},{label:'حالة الإحالة',key:'ref_status'}
      ],
      'الخدمات':[
        {label:'اسم الخدمة',key:'service'},{label:'SLA أيام',key:'sla_days'}
      ],
      'المخزون':[
        {label:'معدات/أدوات',key:'inventory_item'},{label:'الكمية',key:'qty'}
      ],
      'التقارير':[]
    ], adapter:'/api/clinic' },
  education:{ title:'وزارة التعليم', menus:['جاهزية المدرسة','IEP/دمج','الإحالات','تواصل الأسرة','تقارير نور'], fieldsByTab:{
      'جاهزية المدرسة':[ {label:'درجة الجاهزية',key:'readiness_score'},{label:'المدرسة',key:'school_name'} ],
      'IEP/دمج':[ {label:'IEP JSON',key:'iep_json'},{label:'نوع الدمج',key:'inclusion_type'} ],
      'الإحالات':[ {label:'إلى جهة',key:'ref_to'},{label:'مرفقات',key:'attachments'} ],
      'تواصل الأسرة':[ {label:'هوية ولي الأمر',key:'guardian_id'},{label:'القناة',key:'channel'} ],
      'تقارير نور':[]
    ], adapter:'/api/education' },
  neighborhood:{ title:'مراكز الأحياء', menus:['البرامج المجتمعية','المتطوعون','الحجوزات','الإحالات','التقارير'], fieldsByTab:{
      'البرامج المجتمعية':[ {label:'اسم البرنامج',key:'program'},{label:'الفئة العمرية',key:'age_band'},{label:'الطاقة الاستيعابية',key:'capacity'} ],
      'المتطوعون':[ {label:'اسم المتطوع',key:'vol_name'},{label:'ساعات التطوع',key:'vol_hours'} ],
      'الحجوزات':[ {label:'تاريخ',key:'date'},{label:'عدد المقاعد',key:'seats'} ],
      'الإحالات':[ {label:'من/إلى',key:'ref_direction'},{label:'الحالة',key:'status'} ],
      'التقارير':[]
    ], adapter:'/api/neighborhood' },
  nonprofit:{ title:'الجمعيات', menus:['البرامج','المستفيدون','المتطوعون','الإحالات','قياس الأثر','التقارير'], fieldsByTab:{
      'البرامج':[ {label:'اسم البرنامج',key:'program'},{label:'عدد الجلسات',key:'sessions'} ],
      'المستفيدون':[ {label:'هوية ولي الأمر',key:'guardian_id'},{label:'المنطقة',key:'region'} ],
      'المتطوعون':[ {label:'اسم المتطوع',key:'vol_name'},{label:'ساعات التطوع',key:'hours'} ],
      'الإحالات':[ {label:'إلى جهة',key:'ref_to'},{label:'الحالة',key:'status'} ],
      'قياس الأثر':[ {label:'تحسن الطفل (%)',key:'improve_pct'} ],
      'التقارير':[]
    ], adapter:'/api/nonprofit' },
  hr:{ title:'الموارد البشرية', menus:['محفظة الدعم','التطوع الوطني','التقارير'], fieldsByTab:{
      'محفظة الدعم':[ {label:'نوع الدعم',key:'support_type'},{label:'المبلغ/الشهر',key:'amount'},{label:'أهلية الأسرة',key:'eligibility'} ],
      'التطوع الوطني':[ {label:'المبادرة',key:'initiative'},{label:'الساعات',key:'hours'} ],
      'التقارير':[]
    ], adapter:'/api/hr' },
  csr:{ title:'القطاع الخاص (CSR)', menus:['سوق الرعاية','تعهدات الشركة','تقارير الأثر','حوكمة CSR'], fieldsByTab:{
      'سوق الرعاية':[ {label:'اسم الشركة',key:'company'},{label:'الفئة',key:'tier'},{label:'المنطقة',key:'region'} ],
      'تعهدات الشركة':[ {label:'قيمة التعهد',key:'amount'},{label:'الغرض',key:'purpose'} ],
      'تقارير الأثر':[], 'حوكمة CSR':[]
    ], adapter:'/api/csr' },
  family:{ title:'حساب الأسرة', menus:['ملف الحمل والطفل','المواعيد','التوصيات','الخدمات المساندة'], fieldsByTab:{
      'ملف الحمل والطفل':[ {label:'هوية ولي الأمر',key:'guardian_id'},{label:'المنطقة',key:'region'},{label:'موافقة مشاركة البيانات',key:'consent'} ],
      'المواعيد':[ {label:'الخدمة',key:'service'},{label:'موعد',key:'date'} ],
      'التوصيات':[], 'الخدمات المساندة':[]
    ], adapter:'/api/family' },
  admin:{ title:'اللجنة الوطنية', menus:['لوحة وطنية','حوكمة البيانات','التكاملات','التقارير الوطنية'], fieldsByTab:{
      'لوحة وطنية':[],
      'حوكمة البيانات':[ {label:'قرار سياسة',key:'policy_decision'} ],
      'التكاملات':[ {label:'تعريف KPI',key:'kpi_def'} ],
      'التقارير الوطنية':[]
    ], adapter:'/api/admin' }
};

function accountPage(key){
  const A=ACCOUNTS[key]; const v=$('#view');
  const tabs = A.menus;
  const tabButtons = tabs.map((t,i)=>`<button class="tab ${i===0?'active':''}" data-tab="${t}">${t}</button>`).join('');
  v.innerHTML = `
    <div class="card">
      <div class="toolbar"><h2>${A.title}</h2><span class="tag">قوائم تبويبية تفاعلية</span></div>
      <div class="tabs">${tabButtons}</div>
      <div id="tabpanel" class="tabpanel"></div>
      <div style="margin-top:10px">
        <button class="btn" id="save">حفظ (توضيحي)</button>
        <button class="ghost" id="push">إرسال للواجهة البرمجية</button>
      </div>
      <div class="note" style="margin-top:8px">مسار الربط: <code>${loadConfig().apis.internal[key]||A.adapter}</code></div>
    </div>`;
  const renderTab=(name)=>{
    const fields = A.fieldsByTab[name]||[];
    $('#tabpanel').innerHTML = fields.length
      ? `<div class="form grid two">${fields.map(f=>`<label>${f.label}<input data-key="${f.key}" placeholder="${f.key}"/></label>`).join('')}</div>
         ${name==='المواعيد' ? `<div style="margin-top:8px"><button class="btn" id="smartAssign">توزيع ذكي (RBAC)</button></div>
         <pre id="smartOut" class="callout" style="white-space:pre-wrap;margin-top:8px"></pre>`:''}`
      : `<div class="note">لا توجد حقول لهذا القسم حاليًا.</div>`;
    if(name==='المواعيد' && $('#smartAssign')){
      $('#smartAssign').onclick=()=>{
        const region=$('#tabpanel [data-key="region"]')?.value||'الرياض';
        const need=$('#tabpanel [data-key="need"]')?.value||$('#tabpanel [data-key="service"]')?.value||'نمائي';
        const role='clinic.staff'; // في الإنتاج يُقرأ من id_token
        if(!checkPerm(role,'appointment.manage')){ $('#smartOut').textContent='⛔ لا تملك صلاحية الحجز.'; return; }
        const target = pickCenter({region, need, maxSlaDays:14});
        if(target){
          if(occPct(target)<100){ target.bookedToday += 1; $('#smartOut').textContent = `✅ حُجِز في ${target.name} — إشغال: ${occPct(target)}%`; }
          else { $('#smartOut').textContent = `⌛ امتلاء اليوم — انتظار في ${target.name} (تقدير ${estWaitDays(target)} يوم)`; }
        }else{ $('#smartOut').textContent = '⚠️ لا يوجد مركز مناسب.'; }
      };
    }
  };
  renderTab(tabs[0]);
  $$('.tab',v).forEach(btn=>btn.onclick=(e)=>{ $$('.tab',v).forEach(b=>b.classList.remove('active')); e.currentTarget.classList.add('active'); renderTab(e.currentTarget.dataset.tab); });
  $('#save').onclick=()=>alert('تم الحفظ محليًا (توضيحي)');
  $('#push').onclick=()=>{ const inputs = $$('#tabpanel [data-key]'); const payload={entity:key, section:$('.tab.active').dataset.tab, data:Object.fromEntries(inputs.map(i=>[i.dataset.key,i.value]))}; alert('POST '+(loadConfig().apis.internal[key]||A.adapter)+'\n'+JSON.stringify(payload,null,2)); };
}

/* ====== بوابة الرعاة ====== */
const SPONSOR_PLANS=[
  {tier:'ماسي (Diamond)', price:'— ر.س / سنة', perks:['الشعار في كل الصفحات','تقرير أثر ربع سنوي','أولوية تسمية مبادرات','مقعد مجلس الرعاة']},
  {tier:'ذهبي (Gold)', price:'— ر.س / سنة', perks:['الشعار في الصفحات الرئيسية','تقارير نصف سنوية','دعوات الفعاليات']},
  {tier:'فضي (Silver)', price:'— ر.س / سنة', perks:['الشعار في صفحة الرعاة','شارة تقدير في التقارير']}
];
function sponsorsPage(){
  const v=$('#view'); v.innerHTML=`
  <div class="card">
    <div class="toolbar"><h2>بوابة الرعاة</h2><span class="tag">التسعير وحقوق استخدام الهوية</span></div>
    <div class="three grid">
      ${SPONSOR_PLANS.map(p=>`<div class='card'><h3>${p.tier}</h3><div style='font-size:20px;font-weight:800;color:#0f766e'>${p.price}</div><ul>${p.perks.map(x=>`<li>${x}</li>`).join('')}</ul></div>`).join('')}
    </div>
    <h3>طلب رعاية</h3>
    <div class="grid two form">
      <label>اسم الجهة<input id="sp_org"/></label>
      <label>البريد الإلكتروني<input id="sp_mail"/></label>
      <label>فئة الرعاية<select id="sp_tier"><option>Diamond</option><option>Gold</option><option>Silver</option></select></label>
      <label>المنطقة<select id="sp_region"><option>على مستوى المملكة</option><option>الرياض</option><option>الشرقية</option></select></label>
    </div>
    <label style="display:block;margin-top:8px">ملاحظات<textarea id="sp_msg" class="form" style="width:100%;min-height:100px"></textarea></label>
    <div style="margin-top:10px"><button class="btn" id="gen">إنشاء اتفاقية رعاية قابلة للطباعة</button></div>
    <div class="card" id="agreement" style="display:none;margin-top:12px"></div>
  </div>`;
  $('#gen').onclick=()=>{ const org=$('#sp_org').value||'____'; const tier=$('#sp_tier').value; const region=$('#sp_region').value; const today=new Date().toLocaleDateString('ar-SA'); $('#agreement').style.display='block'; $('#agreement').innerHTML=`
    <h3 style='margin-top:0'>اتفاقية رعاية منصة نمو</h3>
    <p>تم في تاريخ <b>${today}</b> بين منصة <b>نمو NOMU</b> والجهة الراعية <b>${org}</b> بصفة <b>${tier}</b> لمنطقة <b>${region}</b>.</p>
    <ul><li>حقوق استخدام الهوية</li><li>التقارير الربع/نصف سنوية</li><li>الامتثال والشفافية</li></ul>
    <button class='ghost' onclick='window.print()'>طباعة / حفظ PDF</button>
  `; };
}

/* ====== أمن وربط: SSO + RBAC + Config ====== */
function ssoPage(){ const v=$('#view'); const cfg=loadConfig(); v.innerHTML=`
  <div class="card"><div class="toolbar"><h2>النفاذ الموحّد (SSO نفاذ)</h2><span class="tag">OIDC — تجريبي</span></div>
  <p>ISSUER: <code>${cfg.sso.issuer}</code> • AUTHZ: <code>${cfg.sso.authorize_url}</code> • TOKEN: <code>${cfg.sso.token_url}</code></p>
  <button class="btn" id="nafath">الدخول عبر نفاذ</button>
  <pre id="ssoLog" class="callout" style="white-space:pre-wrap;margin-top:10px"></pre></div>`;
  $('#nafath').onclick=()=>{ const mockId='USR-'+Math.random().toString(36).slice(2,8).toUpperCase(); $('#ssoLog').textContent='→ تبادل الكود → id_token\nUserID: '+mockId+'\nRoles: ["clinic.staff","referral.accept"]'; };
}
function rbacPage(){ const v=$('#view'); const allPerms=Array.from(new Set(Object.values(RBAC.roles).flat()));
  v.innerHTML=`<div class="card"><div class="toolbar"><h2>صلاحيات RBAC</h2><span class="tag">تعريف وتقييم</span></div>
  <div class="grid two">
    <div><h3>الأدوار</h3>${Object.entries(RBAC.roles).map(([r,ps])=>`<div class='pill'><b>${r}</b>: ${ps.join(', ')}</div>`).join('')}
      <div class="form" style="margin-top:10px"><label>دور<input id="newRole" placeholder="entity.role"/></label>
      <label>امتيازات (بفواصل)<input id="newPerms" placeholder="appointment.manage, referral.accept"/></label>
      <button class="btn" id="addRole">حفظ</button><button class="ghost" id="exportRBAC">تصدير</button></div>
    </div>
    <div><h3>تقييم</h3><div class="form">
      <label>الدور<select id="roleSel">${Object.keys(RBAC.roles).map(r=>`<option>${r}</option>`).join('')}</select></label>
      <label>الامتياز<select id="permSel">${allPerms.map(p=>`<option>${p}</option>`).join('')}</select></label>
      <label>موافقة PDPL؟ <select id="consSel"><option value="true">نعم</option><option value="false">لا</option></select></label></div>
      <button class="btn" id="eval" style="margin-top:10px">تقييم</button>
      <pre id="rbacOut" class="callout" style="white-space:pre-wrap;margin-top:10px"></pre></div>
  </div></div>`;
  $('#addRole').onclick=()=>{ const r=$('#newRole').value.trim(); if(!r) return; const perms=$('#newPerms').value.split(',').map(s=>s.trim()).filter(Boolean); RBAC.roles[r]=perms; alert('تم'); location.hash='#/rbac'; };
  $('#exportRBAC').onclick=()=>downloadJSON('rbac_policy.json', RBAC);
  $('#eval').onclick=()=>{ const role=$('#roleSel').value; const perm=$('#permSel').value; const consent=$('#consSel').value==='true';
    const allowed=checkPerm(role,perm,consent); $('#rbacOut').textContent=(allowed?'✅ مسموح':'⛔ مرفوض')+'\nالدور: '+role+'\nالامتياز: '+perm+'\nالموافقة: '+consent;
  };
}
function configPage(){ const v=$('#view'); const cfg=loadConfig();
  v.innerHTML=`<div class="card"><div class="toolbar"><h2>مركز الإعدادات</h2><span class="tag">Endpoints & Field Maps</span></div>
  <div class="grid two form">
    <label>SSO Issuer<input id="issuer" value="${cfg.sso.issuer}"/></label>
    <label>Authorize URL<input id="authz" value="${cfg.sso.authorize_url}"/></label>
    <label>Token URL<input id="token" value="${cfg.sso.token_url}"/></label>
    <label>Client ID<input id="cid" value="${cfg.sso.client_id}"/></label>
    <label>Redirect URI<input id="redir" value="${cfg.sso.redirect_uri}"/></label>
  </div>
  <h3>مسارات داخلية (Adapters)</h3>
  <div class="grid two form">
    ${Object.entries(cfg.apis.internal).map(([k,v2])=>`<label>${k}<input data-int="${k}" value="${v2}"/></label>`).join('')}
  </div>
  <h3>خرائط الحقول</h3>
  <div class="form"><textarea id="maps" style="width:100%;min-height:220px">${JSON.stringify(cfg.field_maps,null,2)}</textarea></div>
  <div style="margin-top:10px"><button class="btn" id="saveCfg">حفظ</button><button class="ghost" id="dlCfg">تنزيل config.json</button><button class="ghost" id="resetCfg">استعادة الافتراضي</button></div></div>`;
  $('#saveCfg').onclick=()=>{ const next={ sso:{ issuer:$('#issuer').value, authorize_url:$('#authz').value, token_url:$('#token').value, client_id:$('#cid').value, redirect_uri:$('#redir').value },
    apis:{...cfg.apis, internal:Object.fromEntries($$('[data-int]').map(i=>[i.dataset.int,i.value])) }, field_maps: JSON.parse($('#maps').value||'{}') }; saveConfig(next); };
  $('#dlCfg').onclick=()=>downloadJSON('config.json', loadConfig());
  $('#resetCfg').onclick=()=>{ localStorage.removeItem('nomu_config'); alert('تمت الاستعادة'); location.hash='#/config'; };
}

/* ====== سياسات ومساعدة وشروط ====== */
function privacyPage(){ const v=$('#view'); v.innerHTML=`<div class="card">
  <div class="toolbar"><h2>سياسة الخصوصية وحماية البيانات (PDPL)</h2><span class="tag">نسخة تنفيذية</span></div>
  <h3>النطاق</h3><ul><li>بيانات ولي الأمر والطفل</li><li>بيانات نمائية/تعليمية/صحية بموافقة</li><li>بيانات تقنية (سجلات الدخول)</li></ul>
  <h3>الأساس النظامي</h3><ul><li>موافقة صريحة</li><li>مصلحة الطفل الفضلى</li></ul>
  <h3>الحقوق</h3><ul><li>الاطلاع/التصحيح</li><li>سحب الموافقة</li><li>طلب الحذف وفق النظام</li></ul>
  <h3>الأمن</h3><ul><li>تشفير أثناء النقل والتخزين</li><li>RBAC وتسجيل الأثر</li><li>الحد الأدنى للنفاذ</li></ul>
  <button class="ghost" onclick="window.print()">طباعة</button></div>`; }

function childProtectPage(){ const v=$('#view'); v.innerHTML=`<div class="card">
  <div class="toolbar"><h2>سياسة حماية الطفل والإبلاغ</h2><span class="tag">سلامة الطفل أولًا</span></div>
  <h3>المبادئ</h3><ul><li>مصلحة الطفل أولًا</li><li>سرية المعلومات</li><li>عدم التسامح مع الإساءة</li></ul>
  <h3>الإجراءات</h3><ol><li>توثيق الواقعة</li><li>تقييم المخاطر</li><li>الإحالة للجهة المختصة والمتابعة</li></ol>
  <div class="callout"><b>نموذج إبلاغ مختصر:</b><br/>الجهة: ____ • التاريخ: ____ • وصف: ____ • إجراء فوري: ____ • جهة الإحالة: ____</div>
  <button class="ghost" onclick="window.print()">طباعة النموذج</button></div>`; }

function helpCenterPage(){ const v=$('#view'); v.innerHTML=`<div class="card">
  <div class="toolbar"><h2>مركز المساعدة</h2><span class="tag">الدعم والإرشاد</span></div>
  <h3>الأسئلة الشائعة</h3>
  <details open><summary><b>كيف يعمل الموزّع الذكي؟</b></summary><p>يقارن المنطقة/التخصص/الإشغال/الـSLA لاختيار مركز أقل ضغطًا، أو يضيف الطلب لقائمة انتظار المركز.</p></details>
  <details><summary><b>أدوار RBAC؟</b></summary><p>الحجز يتطلب <code>appointment.manage</code>، وقبول الإحالة يتطلب <code>referral.accept</code>.</p></details>
  <details><summary><b>أين تعريفات KPI؟</b></summary><p>في صفحة "سجل تعريفات KPI" مع زر تنزيل JSON.</p></details>
  <h3>طلب دعم</h3>
  <div class="grid two form">
    <label>الاسم <input id="hc_name" placeholder="اسمك"/></label>
    <label>البريد <input id="hc_mail" placeholder="example@domain.sa"/></label>
    <label>الجهة <input id="hc_org" placeholder="وزارة/جمعية/شركة"/></label>
    <label>النوع <select id="hc_type"><option>نفاذ/دخول</option><option>صلاحيات</option><option>الإحالات</option><option>تكاملات</option><option>أخرى</option></select></label>
  </div>
  <label>الوصف<textarea id="hc_desc" style="width:100%;min-height:120px"></textarea></label>
  <div style="margin-top:10px"><button class="btn" id="hc_submit">إرسال (توضيحي)</button><button class="ghost" id="hc_print">طباعة</button></div>
  <pre id="hc_out" class="callout" style="white-space:pre-wrap;margin-top:10px"></pre>
</div>`;
  $('#hc_submit').onclick=()=>{ const payload={name:$('#hc_name').value,email:$('#hc_mail').value,org:$('#hc_org').value,type:$('#hc_type').value,desc:$('#hc_desc').value,ts:new Date().toISOString()}; $('#hc_out').textContent='تم استلام طلبك (توضيحي):\n'+JSON.stringify(payload,null,2); };
  $('#hc_print').onclick=()=>window.print();
}

function termsPage(){ const v=$('#view'); v.innerHTML=`<div class="card">
  <div class="toolbar"><h2>الشروط والأحكام</h2><span class="tag">نسخة استخدام</span></div>
  <ul>
    <li>الاستخدام يخضع للسياسات الوطنية وحماية الطفل وPDPL.</li>
    <li>حظر مشاركة بيانات تعريفية خارج المنظومة دون سند نظامي.</li>
    <li>التكاملات عبر قنوات رسمية وتسجيل أذونات الوصول.</li>
  </ul>
  <button class="ghost" onclick="window.print()">طباعة</button>
</div>`; }

/* ====== API Docs (واجهة مبدئية) ====== */
function apiDocsPage(){
  const v=$('#view'); const cfg=loadConfig();
  v.innerHTML=`
  <div class="card">
    <div class="toolbar"><h2>API Docs</h2><span class="tag">عينة توثيق</span></div>
    <p>نقاط الربط الداخلية (Adapters):</p>
    <table><thead><tr><th>الكيان</th><th>Endpoint</th></tr></thead>
      <tbody>${Object.entries(cfg.apis.internal).map(([k,val])=>`<tr><td>${k}</td><td><code>${val}</code></td></tr>`).join('')}</tbody>
    </table>
    <h3>نموذج إحالة (POST)</h3>
    <pre class="callout">POST /api/health/referral
{ "mrn":"...", "ref_to":"education", "priority":"high", "attachments":["url1","url2"] }</pre>
  </div>`;
}

/* ====== Export ====== */
function exportPage(){ const v=$('#view'); v.innerHTML=`
  <div class="card"><h2>تصدير</h2>
  <button class="btn" id="kjson">KPI Registry</button>
  <button class="ghost" id="rjson">RBAC</button>
  <button class="ghost" id="cfg">Config</button></div>`;
  $('#kjson').onclick=()=>downloadJSON('kpi_registry.json', KPI_REGISTRY);
  $('#rjson').onclick=()=>downloadJSON('rbac_policy.json', RBAC);
  $('#cfg').onclick=()=>downloadJSON('config.json', loadConfig());
}

/* ====== Router ====== */
const routes={
  '/intro':intro,'/kpi-registry':kpiRegistryPage,'/sponsors':sponsorsPage,'/sso':ssoPage,'/rbac':rbacPage,'/config':configPage,'/export':exportPage,'/apidocs':apiDocsPage,
  '/dispatch':dispatchPage,'/ops':opsPage,
  '/privacy':privacyPage,'/child-protect':childProtectPage,'/help':helpCenterPage,'/terms':termsPage,
  '/acc/health':()=>accountPage('health'),'/acc/clinic':()=>accountPage('clinic'),'/acc/education':()=>accountPage('education'),
  '/acc/neighborhood':()=>accountPage('neighborhood'),'/acc/nonprofit':()=>accountPage('nonprofit'),
  '/acc/hr':()=>accountPage('hr'),'/acc/csr':()=>accountPage('csr'),'/acc/family':()=>accountPage('family'),'/acc/admin':()=>accountPage('admin')
};
if(!location.hash) location.hash = '#/intro';
route();
</script>
</body>
</html>
