import React, { useMemo, useState } from "react";
import { motion } from "framer-motion";
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";
import { Input } from "@/components/ui/input";
import { Textarea } from "@/components/ui/textarea";
import { Label } from "@/components/ui/label";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
import { Badge } from "@/components/ui/badge";
import { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from "@/components/ui/dialog";
import { Table, TableBody, TableCaption, TableCell, TableHead, TableHeader, TableRow } from "@/components/ui/table";
import { Switch } from "@/components/ui/switch";
import { Separator } from "@/components/ui/separator";
import { Download, Search, Plus, Save, Info, Shield, HelpCircle, Building2, Landmark, University, Users, HandCoins, Activity, Stethoscope, Cog, Layers, Globe2, FileText, ClipboardList, LineChart, Settings2, ListFilter } from "lucide-react";

/**
 * منصة نمو — ملف واجهة موحد بنسخة واحدة (Single-File React Component)
 * 
 * ملاحظات:
 * - يعتمد على Tailwind + shadcn/ui + framer-motion + lucide-react
 * - هذا ملف واجهة فقط (بدون باك-إند). جميع الجداول تعمل على بيانات وهمية قابلة للتعديل.
 * - يشمل: مقدمة، الرؤية، الرسالة، الأهداف، القيمة المضافة، الحسابات والخدمات حتى 4 مستويات (نماذج تشغيلية)، السياسات، مركز المساعدة، وتعريفات KPI داخل الكود.
 * - يتضمن "حساب المراكز الصحية" لتخفيف الضغط عن وزارة الصحة، وإمكانية ضمه لاحقًا لمراكز الأحياء حسب سياسة التشغيل.
 * - يحتوي على شعارات SVG مضمّنة (للاستخدام التجريبي) ويمكن استبدالها لاحقًا بصور رسمية.
 */

// شعارات SVG بسيطة قابلة للاستبدال لاحقًا
const Logos = {
  nomo: (
    <svg viewBox="0 0 200 50" className="h-8 w-auto">
      <defs>
        <linearGradient id="g1" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0%" stopColor="#0ea5e9" />
          <stop offset="100%" stopColor="#22c55e" />
        </linearGradient>
      </defs>
      <rect x="0" y="0" width="200" height="50" rx="10" fill="url(#g1)" opacity="0.08" />
      <text x="20" y="33" fontFamily="ui-sans-serif" fontSize="28" fontWeight="800" fill="#0f172a">نمو</text>
      <circle cx="150" cy="25" r="8" fill="#22c55e" />
      <circle cx="170" cy="25" r="8" fill="#0ea5e9" />
    </svg>
  ),
  vision2030: (
    <svg viewBox="0 0 200 50" className="h-8 w-auto">
      <text x="0" y="35" fontFamily="ui-sans-serif" fontSize="22" fontWeight="700" fill="#334155">Vision 2030</text>
      <circle cx="170" cy="25" r="10" fill="#94a3b8" />
    </svg>
  ),
  mcit: (
    <svg viewBox="0 0 200 50" className="h-8 w-auto">
      <text x="0" y="35" fontFamily="ui-sans-serif" fontSize="22" fontWeight="700" fill="#334155">MCIT</text>
      <rect x="150" y="10" width="40" height="30" rx="5" fill="#0ea5e9" />
    </svg>
  ),
  monshaat: (
    <svg viewBox="0 0 200 50" className="h-8 w-auto">
      <text x="0" y="35" fontFamily="ui-sans-serif" fontSize="22" fontWeight="700" fill="#334155">Monsha'at</text>
      <path d="M150 35 L170 15 L190 35 Z" fill="#22c55e" />
    </svg>
  ),
};

// أنواع الحسابات الرئيسية
const ACCOUNT_TABS = [
  { key: "government", label: "القطاع الحكومي", icon: Landmark },
  { key: "private", label: "القطاع الخاص", icon: Building2 },
  { key: "nonprofit", label: "القطاع غير الربحي", icon: HandCoins },
  { key: "university", label: "الجامعات", icon: University },
  { key: "donor", label: "المانحون", icon: Users },
  { key: "individual", label: "الأفراد", icon: Activity },
  { key: "health", label: "المراكز الصحية", icon: Stethoscope },
];

// خدمات عامة (قابلة للتفريع حتى 4 مستويات)
const SERVICE_TREE = {
  government: [
    {
      name: "إدارة المبادرات الحكومية",
      children: [
        { name: "ربط بمستهدفات رؤية 2030", children: [
          { name: "الأهداف الاستراتيجية (27)" },
          { name: "الأهداف الفرعية (96)" },
          { name: "مصفوفة القياس والمؤشرات" },
        ] },
        { name: "إدارة الحلول المشتركة", children: [
          { name: "دعوة القطاع الخاص" },
          { name: "دعوة الجامعات (تعزيز علمي)" },
          { name: "دعوة القطاع غير الربحي" },
        ] },
        { name: "ملفات الشراكات والموافقات" },
      ],
    },
    {
      name: "إدارة الفعاليات والمرافق",
      children: [
        { name: "طلبات اعتماد الفعاليات" },
        { name: "إدارة المرافق" },
        { name: "قبول/رفض الشراكات الاستراتيجية" },
      ],
    },
    { name: "تقارير المنطقة الذكية", children: [
      { name: "الشركات الأكثر دعمًا" },
      { name: "مؤشرات التوظيف" },
      { name: "الفرص التدريبية" },
    ] },
  ],
  private: [
    { name: "إدارة الفرص", children: [
      { name: "رعايات تجارية (مسؤولية اجتماعية)" },
      { name: "استثمارات تنموية" },
      { name: "تأجير مرافق" },
    ] },
    { name: "الأحداث والمرافق" },
    { name: "تقارير المسؤولية الاجتماعية" },
  ],
  nonprofit: [
    { name: "المنح والتمويل والاشتراكات" },
    { name: "الوظائف والتطوع والتدريب" },
    { name: "الحوكمة والشفافية (لوحة متابعة)" },
  ],
  university: [
    { name: "التعزيز العلمي للمشاريع", children: [
      { name: "مراجعات علمية" },
      { name: "عقود مشاركة علمية/عوائد" },
    ] },
    { name: "تسويق البرامج والمبادرات والبحوث" },
    { name: "تأجير المرافق الجامعية" },
  ],
  donor: [
    { name: "فرص المنح حسب معايير المانح" },
    { name: "محفظة المانح وتقاريره" },
    { name: "اتفاقيات الرعاية" },
  ],
  individual: [
    { name: "مبادراتي (نموذج اللبنات التسع)" },
    { name: "الوظائف والتطوع والتدريب" },
    { name: "المحفظة والدفع" },
  ],
  health: [
    { name: "مواعيد وخدمات المراكز الصحية" },
    { name: "الربط مع مستوصفات الأحياء" },
    { name: "التقارير الصحية المجتمعية" },
  ],
};

// بيانات وهمية موحدة للجداول
const MOCK_ITEMS = Array.from({ length: 32 }).map((_, i) => ({
  id: i + 1,
  title: `عنصر ${i + 1}`,
  owner: ["إمارة المنطقة","شركة خاصة","جامعة","جمعية","فرد","مانح"][i % 6],
  status: ["مسودة","بانتظار الموافقة","فعّال","مكتمل"][i % 4],
  kpi: ["معدل التوظيف","تنويع الاقتصاد","تعزيز الهوية","حياة عامرة"][i % 4],
  score: Math.round(60 + Math.random()*40),
}));

// تعريفات KPI داخل الكود — قابلة للتعديل من الواجهة وحفظها مؤقتًا
const DEFAULT_KPIS = [
  { key: "employment_rate", name: "معدل التوظيف", owner: "وزارة الموارد البشرية", definition: "نسبة العاملين السعوديين من إجمالي القوى العاملة في المنطقة." },
  { key: "economic_diversity", name: "تنويع الاقتصاد", owner: "وزارة الاقتصاد", definition: "مساهمة القطاعات غير النفطية في الناتج المحلي." },
  { key: "gov_effectiveness", name: "تعزيز فاعلية الحكومة", owner: "وزارة المالية", definition: "تحسين زمن إنجاز الخدمات الحكومية وجودتها." },
  { key: "national_identity", name: "تعزيز الهوية الوطنية", owner: "وزارة الثقافة", definition: "مستوى المشاركة في الفعاليات الثقافية والإبداعية." },
  { key: "healthy_life", name: "تمكين حياة عامرة وصحية", owner: "وزارة الصحة", definition: "مؤشر نمط الحياة الصحي ونسب الأمراض المزمنة." },
];

// شجرة عرض الخدمات حتى 4 مستويات
function ServiceTree({ nodes }: { nodes: any[] }) {
  return (
    <ul className="space-y-2">
      {nodes.map((n, idx) => (
        <li key={idx}>
          <div className="flex items-center gap-2">
            <Layers className="h-4 w-4" />
            <span className="font-medium">{n.name}</span>
          </div>
          {n.children && n.children.length > 0 && (
            <div className="ms-4 mt-2 border-s ps-4">
              <ServiceTree nodes={n.children} />
            </div>
          )}
        </li>
      ))}
    </ul>
  );
}

// مكوّن شعار في الشريط العلوي
function TopBar() {
  return (
    <div className="w-full sticky top-0 z-40 backdrop-blur bg-white/70 border-b">
      <div className="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between gap-4">
        <div className="flex items-center gap-3">
          {Logos.nomo}
          <Separator orientation="vertical" className="h-8" />
          <div className="hidden md:flex items-center gap-4">
            <Badge variant="secondary" className="gap-1"><Globe2 className="h-3.5 w-3.5" /> منصة نمو</Badge>
            <Badge variant="outline" className="gap-1"><Shield className="h-3.5 w-3.5" /> خصوصية الطفل</Badge>
            <Badge variant="outline" className="gap-1"><HelpCircle className="h-3.5 w-3.5" /> مركز المساعدة</Badge>
          </div>
        </div>
        <div className="flex items-center gap-2 w-full max-w-md">
          <div className="relative w-full">
            <Search className="absolute start-3 top-1/2 -translate-y-1/2 h-4 w-4" />
            <Input placeholder="ابحث في كل شيء…" className="ps-9" />
          </div>
          <Button variant="outline" className="gap-1"><Download className="h-4 w-4" /> تصدير</Button>
        </div>
      </div>
    </div>
  );
}

// بطاقة مقدمة + الرؤية + الرسالة + الأهداف
function IntroCard() {
  return (
    <Card className="rounded-2xl shadow-sm">
      <CardHeader>
        <CardTitle>منصة نمو — مقدمة تعريفية</CardTitle>
        <CardDescription>منصة تكاملية تربط الحكومة والقطاع الخاص والجامعات والقطاع غير الربحي والأفراد والمانحين لتحقيق مستهدفات رؤية المملكة 2030.</CardDescription>
      </CardHeader>
      <CardContent className="space-y-6">
        <div className="grid md:grid-cols-3 gap-4">
          <div className="p-4 rounded-xl border bg-white">
            <h3 className="font-bold mb-2">الرؤية</h3>
            <p>منظومة تكاملية تمكّن الحلول وتسرّع الأثر التنموي المستدام في كل منطقة.</p>
          </div>
          <div className="p-4 rounded-xl border bg-white">
            <h3 className="font-bold mb-2">الرسالة</h3>
            <p>تفعيل شراكات علمية وتنفيذية وتمويلية تربط الاحتياج بالحل، مع حوكمة وقياس أثر شفاف.</p>
          </div>
          <div className="p-4 rounded-xl border bg-white">
            <h3 className="font-bold mb-2">الأهداف</h3>
            <ul className="list-disc ms-5 space-y-1 text-sm">
              <li>رفع جودة المشاريع وتسريع الإنجاز.</li>
              <li>تعزيز فاعلية الحكومة وتسهيل ممارسة الأعمال.</li>
              <li>تمكين المسؤولية الاجتماعية والاستثمار التنموي.</li>
              <li>تعزيز التكامل بين القطاعات وتمكين حياة عامرة وصحية.</li>
            </ul>
          </div>
        </div>

        <div className="grid md:grid-cols-3 gap-4">
          <Card className="border-dashed">
            <CardHeader className="pb-2"><CardTitle className="text-base">القيمة المضافة — الحكومة</CardTitle></CardHeader>
            <CardContent className="text-sm">لوحة متابعة أداء المنطقة، ربط آلي بمستهدفات الرؤية، إدارة الموافقات والفعاليات والمرافق، تتبّع الشركاء المساهمين.</CardContent>
          </Card>
          <Card className="border-dashed">
            <CardHeader className="pb-2"><CardTitle className="text-base">القيمة المضافة — القطاع الخاص</CardTitle></CardHeader>
            <CardContent className="text-sm">فرص رعاية واستثمار مرتبطة بقياس أثر، تقارير مسؤولية اجتماعية، منافذ تأجير مرافق، واجهات مبسطة للطلبات.</CardContent>
          </Card>
          <Card className="border-dashed">
            <CardHeader className="pb-2"><CardTitle className="text-base">القيمة المضافة — الجامعات</CardTitle></CardHeader>
            <CardContent className="text-sm">تعزيز علمي للمشاريع برسوم مشاركة، تسويق برامج وبحوث، جذب شركاء وتمويل، مشاركة مرافق.</CardContent>
          </Card>
          <Card className="border-dashed">
            <CardHeader className="pb-2"><CardTitle className="text-base">القيمة المضافة — غير الربحي</CardTitle></CardHeader>
            <CardContent className="text-sm">تمويل ومنح واشتراكات، إدارة متطوعين وتدريب، لوحة حوكمة وشفافية، مؤشرات أثر مجتمعي.</CardContent>
          </Card>
          <Card className="border-dashed">
            <CardHeader className="pb-2"><CardTitle className="text-base">القيمة المضافة — المانحون</CardTitle></CardHeader>
            <CardContent className="text-sm">محفظة مانح، فرص مصفّاة بمعايير، تقارير أثر، توثيق الرعايات والاتفاقيات.</CardContent>
          </Card>
          <Card className="border-dashed">
            <CardHeader className="pb-2"><CardTitle className="text-base">القيمة المضافة — الأفراد</CardTitle></CardHeader>
            <CardContent className="text-sm">نشر مبادرات بنموذج اللبنات التسع، فرص عمل وتطوع وتدريب، محفظة ودفع.</CardContent>
          </Card>
        </div>
      </CardContent>
    </Card>
  );
}

// لوحة تعريفات KPIs
function KPIsPanel() {
  const [kpis, setKpis] = useState(DEFAULT_KPIS);
  const [json, setJson] = useState(JSON.stringify(kpis, null, 2));
  const [valid, setValid] = useState(true);

  function apply() {
    try {
      const parsed = JSON.parse(json);
      if (!Array.isArray(parsed)) throw new Error("صيغة غير صحيحة");
      setKpis(parsed);
      setValid(true);
    } catch (e) {
      setValid(false);
    }
  }

  return (
    <Card className="rounded-2xl">
      <CardHeader>
        <CardTitle className="flex items-center gap-2"><LineChart className="h-5 w-5" /> تعريفات المؤشرات (KPI) وملاّكها</CardTitle>
        <CardDescription>يمكنكم إدخال تعريفاتكم الرسمية لكل KPI وملاكها داخل الكود من خلال هذا المحرر. (تُحفظ مؤقتًا في الواجهة)</CardDescription>
      </CardHeader>
      <CardContent className="space-y-4">
        <div className="grid md:grid-cols-2 gap-4">
          <div className="space-y-2">
            <Label>JSON</Label>
            <Textarea value={json} onChange={(e) => setJson(e.target.value)} className="font-mono h-64" />
            <div className="flex items-center gap-2">
              <Button className="gap-1" onClick={apply}><Save className="h-4 w-4" /> تطبيق</Button>
              {!valid && <span className="text-red-600 text-sm">صيغة JSON غير صحيحة</span>}
            </div>
          </div>
          <div className="space-y-2">
            <Label>المعايير الحالية</Label>
            <div className="p-3 border rounded-xl bg-slate-50 space-y-2 max-h-64 overflow-auto">
              {kpis.map((k) => (
                <div key={k.key} className="p-2 bg-white rounded-lg border">
                  <div className="flex items-center justify-between">
                    <strong>{k.name}</strong>
                    <Badge variant="secondary">{k.owner}</Badge>
                  </div>
                  <p className="text-sm text-slate-600 mt-1">{k.definition}</p>
                </div>
              ))}
            </div>
          </div>
        </div>
      </CardContent>
    </Card>
  );
}

// جدول قابل للبحث والتصفية
function DataTable({ title }: { title: string }) {
  const [q, setQ] = useState("");
  const [status, setStatus] = useState<string | null>(null);
  const data = useMemo(() => {
    return MOCK_ITEMS.filter((r) =>
      (!q || r.title.includes(q) || r.owner.includes(q) || r.kpi.includes(q)) &&
      (!status || r.status === status)
    );
  }, [q, status]);

  return (
    <Card className="rounded-2xl">
      <CardHeader className="flex flex-col gap-2">
        <div className="flex flex-wrap items-center justify-between gap-3">
          <div>
            <CardTitle className="text-lg">{title}</CardTitle>
            <CardDescription>نتائج مفلترة حسب البحث والحالة</CardDescription>
          </div>
          <div className="flex items-center gap-2">
            <div className="relative">
              <Search className="absolute start-3 top-1/2 -translate-y-1/2 h-4 w-4" />
              <Input placeholder="بحث…" value={q} onChange={(e) => setQ(e.target.value)} className="ps-9 w-56" />
            </div>
            <Select onValueChange={(v) => setStatus(v)}>
              <SelectTrigger className="w-56"><ListFilter className="me-2 h-4 w-4" />
                <SelectValue placeholder="تصفية حسب الحالة" />
              </SelectTrigger>
              <SelectContent>
                { ["مسودة","بانتظار الموافقة","فعّال","مكتمل"].map(s => <SelectItem key={s} value={s}>{s}</SelectItem>) }
              </SelectContent>
            </Select>
            <Dialog>
              <DialogTrigger asChild>
                <Button className="gap-1"><Plus className="h-4 w-4" /> عنصر جديد</Button>
              </DialogTrigger>
              <DialogContent>
                <DialogHeader>
                  <DialogTitle>إضافة عنصر</DialogTitle>
                  <DialogDescription>نموذج مبسّط لإضافة عنصر — (حفظ محلي فقط للتجربة)</DialogDescription>
                </DialogHeader>
                <div className="grid gap-3">
                  <Input placeholder="العنوان" />
                  <Input placeholder="المالك" />
                  <Select>
                    <SelectTrigger><SelectValue placeholder="الحالة" /></SelectTrigger>
                    <SelectContent>
                      { ["مسودة","بانتظار الموافقة","فعّال","مكتمل"].map(s => <SelectItem key={s} value={s}>{s}</SelectItem>) }
                    </SelectContent>
                  </Select>
                  <Button className="gap-1"><Save className="h-4 w-4" /> حفظ</Button>
                </div>
              </DialogContent>
            </Dialog>
          </div>
        </div>
      </CardHeader>
      <CardContent>
        <Table>
          <TableCaption>قائمة العناصر</TableCaption>
          <TableHeader>
            <TableRow>
              <TableHead>#</TableHead>
              <TableHead>العنوان</TableHead>
              <TableHead>المالك</TableHead>
              <TableHead>الحالة</TableHead>
              <TableHead>KPI</TableHead>
              <TableHead>النتيجة</TableHead>
            </TableRow>
          </TableHeader>
          <TableBody>
            {data.map((r) => (
              <TableRow key={r.id}>
                <TableCell>{r.id}</TableCell>
                <TableCell className="font-medium">{r.title}</TableCell>
                <TableCell>{r.owner}</TableCell>
                <TableCell>
                  <Badge variant={r.status === "فعّال" ? "default" : "secondary"}>{r.status}</Badge>
                </TableCell>
                <TableCell>{r.kpi}</TableCell>
                <TableCell>{r.score}</TableCell>
              </TableRow>
            ))}
          </TableBody>
        </Table>
      </CardContent>
    </Card>
  );
}

// بطاقة سياسات الخصوصية/حماية الطفل
function PoliciesCard() {
  const [childSafe, setChildSafe] = useState(true);
  const [retention, setRetention] = useState(12);
  return (
    <Card className="rounded-2xl">
      <CardHeader>
        <CardTitle className="flex items-center gap-2"><Shield className="h-5 w-5" /> السياسات والخصوصية</CardTitle>
        <CardDescription>ملخص سياسات خصوصية البيانات وحماية الطفل — نموذج قابل للتخصيص.</CardDescription>
      </CardHeader>
      <CardContent className="space-y-4">
        <div className="grid md:grid-cols-3 gap-4">
          <div className="p-4 rounded-xl border">
            <h4 className="font-bold mb-2">حماية الطفل</h4>
            <div className="flex items-center justify-between">
              <span className="text-sm text-slate-600">تفعيل أدوات الحماية</span>
              <Switch checked={childSafe} onCheckedChange={setChildSafe} />
            </div>
            <p className="text-xs text-slate-500 mt-3">يشمل ذلك إخفاء بيانات الأطفال الحساسة، إشعارات موافقة ولي الأمر، وآليات الإبلاغ.</p>
          </div>
          <div className="p-4 rounded-xl border">
            <h4 className="font-bold mb-2">الاحتفاظ بالبيانات</h4>
            <div className="flex items-center gap-2">
              <Input type="number" value={retention} onChange={(e)=>setRetention(parseInt(e.target.value||"0"))} className="w-24" />
              <span>شهرًا</span>
            </div>
            <p className="text-xs text-slate-500 mt-3">يُحذف تلقائيًا ما لم تتطلب الأنظمة الاحتفاظ لفترة أطول.</p>
          </div>
          <div className="p-4 rounded-xl border">
            <h4 className="font-bold mb-2">الاستخدام العادل</h4>
            <p className="text-sm text-slate-600">تستخدم البيانات لأغراض تنموية فقط، مع منع إعادة البيع أو الاستخدام التجاري المخالف، وتفعيل إخفاء الهوية للتحليلات.</p>
          </div>
        </div>
      </CardContent>
    </Card>
  );
}

// بطاقة مركز المساعدة
function HelpCenterCard() {
  return (
    <Card className="rounded-2xl">
      <CardHeader>
        <CardTitle className="flex items-center gap-2"><HelpCircle className="h-5 w-5" /> مركز المساعدة</CardTitle>
        <CardDescription>إجابات سريعة وروابط إرشادية ونماذج تواصل.</CardDescription>
      </CardHeader>
      <CardContent className="grid md:grid-cols-3 gap-4">
        <Card className="border-dashed">
          <CardHeader className="pb-1"><CardTitle className="text-base">كيف أنشر مبادرة؟</CardTitle></CardHeader>
          <CardContent className="text-sm">من تبويب "الأفراد → مبادراتي"، املأ نموذج اللبنات التسع وارفق المستندات ثم أرسل للمراجعة.</CardContent>
        </Card>
        <Card className="border-dashed">
          <CardHeader className="pb-1"><CardTitle className="text-base">كيف أطلب رعاية؟</CardTitle></CardHeader>
          <CardContent className="text-sm">من "القطاع الخاص → إدارة الفرص" اختر "رعاية" وحدد الشروط والمخرجات المتوقعة ومؤشرات الأثر.</CardContent>
        </Card>
        <Card className="border-dashed">
          <CardHeader className="pb-1"><CardTitle className="text-base">تعزيز علمي من الجامعة</CardTitle></CardHeader>
          <CardContent className="text-sm">من "الجامعة → التعزيز العلمي" أضف طلب مراجعة، يحدَّد الخبير ورسوم المشاركة وخطة التسليم.</CardContent>
        </Card>
      </CardContent>
    </Card>
  );
}

// واجهات كل حساب (مختصرات تشغيلية + شجرة الخدمات + جدول)
function AccountPanel({ accountKey }: { accountKey: keyof typeof SERVICE_TREE }) {
  const titles: any = {
    government: { t: "لوحة القطاع الحكومي", d: "إدارة المبادرات والفعاليات والمرافق والربط بالرؤية" },
    private: { t: "لوحة القطاع الخاص", d: "الفرص والرعايات والاستثمارات وتقارير المسؤولية" },
    nonprofit: { t: "لوحة القطاع غير الربحي", d: "المنح والتمويل والحوكمة والشفافية" },
    university: { t: "لوحة الجامعات", d: "التعزيز العلمي وتسويق البرامج وتأجير المرافق" },
    donor: { t: "لوحة المانحين", d: "المحفظة والفرص والتقارير" },
    individual: { t: "لوحة الأفراد", d: "المبادرات والوظائف والتطوع" },
    health: { t: "لوحة المراكز الصحية", d: "المواعيد والربط مع مستوصفات الأحياء والتقارير" },
  };
  const info = titles[accountKey];

  return (
    <div className="space-y-4">
      <Card className="rounded-2xl">
        <CardHeader>
          <CardTitle>{info.t}</CardTitle>
          <CardDescription>{info.d}</CardDescription>
        </CardHeader>
        <CardContent className="grid md:grid-cols-2 gap-4">
          <div className="p-4 rounded-xl border">
            <h4 className="font-bold mb-2 flex items-center gap-2"><ClipboardList className="h-4 w-4" /> شجرة الخدمات (حتى 4 مستويات)</h4>
            <ServiceTree nodes={(SERVICE_TREE as any)[accountKey]} />
          </div>
          <div className="p-4 rounded-xl border">
            <h4 className="font-bold mb-2 flex items-center gap-2"><Settings2 className="h-4 w-4" /> إعدادات سريعة</h4>
            <div className="grid gap-3 text-sm">
              <div className="flex items-center justify-between"><span>تفعيل استقبال الطلبات</span><Switch defaultChecked /></div>
              <div className="flex items-center justify-between"><span>إظهار مؤشرات الأثر</span><Switch defaultChecked /></div>
              <div className="flex items-center justify-between"><span>إتاحة الحجز الذكي</span><Switch /></div>
            </div>
          </div>
        </CardContent>
      </Card>

      <DataTable title="قائمة العناصر/الطلبات/المشاريع" />
    </div>
  );
}

// الشريط السفلي للشركاء (شعارات)
function PartnersStrip() {
  return (
    <div className="max-w-7xl mx-auto px-4">
      <div className="rounded-2xl border p-4 bg-white/60">
        <div className="text-slate-500 text-sm mb-3">شركاء المنصة (شعارات تجريبية):</div>
        <div className="grid grid-cols-2 md:grid-cols-4 items-center gap-6">
          <div className="flex items-center justify-center">{Logos.vision2030}</div>
          <div className="flex items-center justify-center">{Logos.mcit}</div>
          <div className="flex items-center justify-center">{Logos.monshaat}</div>
          <div className="flex items-center justify-center">{Logos.nomo}</div>
        </div>
      </div>
    </div>
  );
}

export default function NomoPlatform() {
  const [tab, setTab] = useState<string>("overview");

  return (
    <div dir="rtl" className="min-h-screen bg-gradient-to-b from-slate-50 to-white text-slate-900">
      <TopBar />

      <main className="max-w-7xl mx-auto px-4 py-6 space-y-6">
        {/* مقدمة */}
        <motion.div initial={{ opacity: 0, y: 8 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.4 }}>
          <IntroCard />
        </motion.div>

        <Tabs value={tab} onValueChange={setTab} className="space-y-6">
          <TabsList className="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-8 gap-2">
            <TabsTrigger value="overview" className="gap-1"><Info className="h-4 w-4" /> نظرة عامة</TabsTrigger>
            {ACCOUNT_TABS.map(({ key, label, icon: Icon }) => (
              <TabsTrigger key={key} value={key} className="gap-1"><Icon className="h-4 w-4" /> {label}</TabsTrigger>
            ))}
            <TabsTrigger value="kpis" className="gap-1"><LineChart className="h-4 w-4" /> KPIs</TabsTrigger>
            <TabsTrigger value="policies" className="gap-1"><Shield className="h-4 w-4" /> السياسات</TabsTrigger>
            <TabsTrigger value="help" className="gap-1"><HelpCircle className="h-4 w-4" /> المساعدة</TabsTrigger>
          </TabsList>

          <TabsContent value="overview" className="space-y-4">
            <PartnersStrip />
            <DataTable title="لوحة عامة — عناصر عبر كل الحسابات" />
          </TabsContent>

          {ACCOUNT_TABS.map(({ key }) => (
            <TabsContent key={key} value={key}>
              <AccountPanel accountKey={key as keyof typeof SERVICE_TREE} />
            </TabsContent>
          ))}

          <TabsContent value="kpis">
            <KPIsPanel />
          </TabsContent>

          <TabsContent value="policies">
            <PoliciesCard />
          </TabsContent>

          <TabsContent value="help">
            <HelpCenterCard />
          </TabsContent>
        </Tabs>

        <footer className="text-center text-xs text-slate-500 py-6">
          منصة نمو — ملف واجهة موحّد للتجربة. يمكن ربطه بالباك-إند لاحقًا عبر REST/GraphQL. © {new Date().getFullYear()}
        </footer>
      </main>
    </div>
  );
}
